import plugin from'\x2e\x2e\x2f\x2e\x2e\x2f\x2e\x2e\x2f\x6c\x69\x62\x2f\x70\x6c\x75\x67\x69\x6e\x73\x2f\x70\x6c\x75\x67\x69\x6e\x2e\x6a\x73'import cfg from'\x2e\x2e\x2f\x2e\x2e\x2f\x2e\x2e\x2f\x6c\x69\x62\x2f\x63\x6f\x6e\x66\x69\x67\x2f\x63\x6f\x6e\x66\x69\x67\x2e\x6a\x73'import{createRequire}from"\x6d\x6f\x64\x75\x6c\x65";const require=createRequire(import['\x6d\x65\x74\x61']['\x75\x72\x6c']);import fetch from'\x6e\x6f\x64\x65\x2d\x66\x65\x74\x63\x68'import fs from"\x66\x73"const _path=process['\x63\x77\x64']();import puppeteer from'\x2e\x2e\x2f\x2e\x2e\x2f\x2e\x2e\x2f\x6c\x69\x62\x2f\x70\x75\x70\x70\x65\x74\x65\x65\x72\x2f\x70\x75\x70\x70\x65\x74\x65\x65\x72\x2e\x6a\x73'let apikey;let model;let type;let CD={};let htnum let history=[]let botname="\x23\x67\x70\x74\x78"let GetCD=true;let CDTime=120000;let dirpath=_path+'\x2f\x72\x65\x73\x6f\x75\x72\x63\x65\x73\x2f\x67\x70\x74 \x6b\x65\x79'let dirpath2=_path+'\x2f\x72\x65\x73\x6f\x75\x72\x63\x65\x73\x2f\x67\x70\x74 \x6e\x61\x6d\x65'if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath)){fs['\x6d\x6b\x64\x69\x72\x53\x79\x6e\x63'](dirpath)}if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2)){fs['\x6d\x6b\x64\x69\x72\x53\x79\x6e\x63'](dirpath2)}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))botname=js['\x67\x70\x74\x78']['\x62\x6f\x74\x6e\x61\x6d\x65']}let res=await fetch('\x68\x74\x74\x70\x73\x3a\x2f\x2f\x73\x68\x6f\x75\x71\x75\x61\x6e\x2d\x31\x33\x31\x35\x35\x34\x34\x35\x36\x32\x2e\x63\x6f\x73\x2e\x61\x70\x2d\x6e\x61\x6e\x6a\x69\x6e\x67\x2e\x6d\x79\x71\x63\x6c\x6f\x75\x64\x2e\x63\x6f\x6d\x2f\x73\x71\x71\x71\x2e\x6a\x73\x6f\x6e')res=await res['\x6a\x73\x6f\x6e']()if(JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](res['\x71\x71'])['\x69\x6e\x64\x65\x78\x4f\x66'](JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](cfg['\x6d\x61\x73\x74\x65\x72\x51\x51'][0]))==-1){apikey="\x31\x31\x34\x35\x31\x34"}else{let kkk=await res['\x67\x70\x74\x78'] apikey=kkk[window["\x4d\x61\x74\x68"]['\x66\x6c\x6f\x6f\x72']((window["\x4d\x61\x74\x68"]['\x72\x61\x6e\x64\x6f\x6d']()*kkk['\x6c\x65\x6e\x67\x74\x68']))]}export class example extends plugin{constructor(){super({name:'\x70\x6f\x65\x2d\x61\x69\u7b49',dsc:'\x67\x70\x74\x78\x78',event:'\x6d\x65\x73\x73\x61\x67\x65',priority:1500,rule:[{reg:'\x5e\x23\x28\x67\x70\x74\u6a21\u578b\x7c\u6a21\u578b\x29\x3f\x28\u5927\u5168\x7c\u603b\u89c8\x29\x24',fnc:'\x6d\x6f\x64\x65\x6c\x68\x70'},{reg:'\x5e\x23\x67\x70\x74\u5207\u6362\u6a21\u578b\x28\x2e\x2a\x29\x24',fnc:'\x63\x68\x61\x6e\x67\x65\x6d\x6f\x64\x65\x6c'},{reg:'\x5e\x23\u586b\u5199\x67\x70\x74\x6b\x65\x79\x24',fnc:'\x67\x70\x74\x6b\x65\x79'},{reg:'\x5e\x23\x67\x70\x74\u5bf9\u8bdd\u65b9\u5f0f\x28\x2e\x2a\x29\x24',fnc:'\x67\x70\x74\x66\x73'},{reg:'\x5e\x23\x67\x70\x74\u5bf9\u8bdd\u7ed3\u675f\x24\x7c\x5e\x23\x67\x70\x74\u7ed3\u675f\u5168\u90e8\u5bf9\u8bdd\x24',fnc:'\x6a\x73\x64\x68'},{reg:'\x5e\x23\u751f\u6210\u5267\u672c\x28\x2e\x2a\x29\x24',fnc:'\x6a\x62\x73\x63'},{reg:'\x5e\x23\u66f4\u6539\u5267\u672c\u79cd\u7c7b\x28\x2e\x2a\x29\x24\x7c\x23\u5267\u672c\u79cd\u7c7b\x24',fnc:'\x6a\x62\x6c\x78'},{reg:'\x5e\x23\u85cf\u5934\u8bd7\u4e94\u8a00\x28\x2e\x2a\x29\x24\x7c\x5e\x23\u85cf\u5934\u8bd7\u4e03\u8a00\x28\x2e\x2a\x29\x24\x7c\x5e\x23\u85cf\u5c3e\u8bd7\u4e94\u8a00\x28\x2e\x2a\x3f\x29\x24\x7c\x5e\x23\u85cf\u5c3e\u8bd7\u4e03\u8a00\x28\x2e\x2a\x3f\x29\x24',fnc:'\x63\x74\x73'},{reg:'\x5e\x23\x67\x70\x74\u5207\u6362\u9884\u8bbe\x28\x2e\x2a\x29\x24\x7c\x5e\x23\x67\x70\x74\u9884\u8bbe\u5927\u5168\x28\x2e\x2a\x29\x24\x7c\x5e\x23\x67\x70\x74\u67e5\u770b\u9884\u8bbe\x28\x2e\x2a\x29\x24\x7c\x5e\x23\x67\x70\x74\u5220\u9664\u9884\u8bbe\x28\x2e\x2a\x29\x24',fnc:'\x67\x70\x74\x79\x73'},{reg:`^${botname}([\s\S]*)|#gpt新增预设([\s\S]*)$`,fnc:'\x67\x70\x74\x78'},{reg:'\x5e\x23\x67\x70\x74\u6539\u540d\x28\x2e\x2a\x3f\x29\x24',fnc:'\x67\x70\x74\x67\x6d'},{reg:'\x5e\x23\x67\x70\x74\u7ed8\u56fe\x28\x2e\x2a\x3f\x29\x24',fnc:'\x67\x70\x74\x68\x74'},{reg:'\x5e\x23\x67\x70\x74\u8bbe\u7f6e\u7ed8\u56fe\u5f20\u6570\x28\x2e\x2a\x3f\x29\x24',fnc:'\x67\x70\x74\x68\x74\x7a\x73'},{reg:'\x5e\x23\x67\x70\x74\x3f\x28\u6253\u5370\x7c\u67e5\u770b\x29\x3f\x28\u8bb0\u5f55\x7c\u5386\u53f2\x29\x24',fnc:'\x67\x70\x74\x6a\x6c'},{reg:'\x5e\x23\u8bbe\u7f6e\u7528\u6237\u6846\u989c\u8272\x28\x2e\x2a\x29\x24\x7c\x5e\x23\u8bbe\u7f6e\u56de\u590d\u6846\u989c\u8272\x28\x2e\x2a\x29\x24',fnc:'\x64\x68\x6b'}]})}async dhk(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\u8bbe\u7f6e\u7528\u6237\u6846\u989c\u8272")){let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#设置用户框颜色/g,"")['\x74\x72\x69\x6d']()let js=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],"\x75\x74\x66\x2d\x38")let gh=js['\x6d\x61\x74\x63\x68'](/background-color:(.*?);/g)console['\x6c\x6f\x67'](gh[1])js=js['\x72\x65\x70\x6c\x61\x63\x65'](gh[1],`background-color:${msg};`)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],js,"\x75\x74\x66\x2d\x38")e['\x72\x65\x70\x6c\x79']("\u7528\u6237\u6846\u989c\u8272\u6210\u529f\u4fee\u6539\x21")}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\u8bbe\u7f6e\u56de\u590d\u6846\u989c\u8272")){let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#设置回复框颜色/g,"")['\x74\x72\x69\x6d']()let js=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],"\x75\x74\x66\x2d\x38")let gh=js['\x6d\x61\x74\x63\x68'](/background-color:(.*?);/g)console['\x6c\x6f\x67'](gh[2])js=js['\x72\x65\x70\x6c\x61\x63\x65'](gh[2],`background-color:${msg};`)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],js,"\x75\x74\x66\x2d\x38")e['\x72\x65\x70\x6c\x79']("\u56de\u590d\u6846\u989c\u8272\u6210\u529f\u4fee\u6539\x21")}}async gptjl(e){if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60']))console['\x6c\x6f\x67'](js)let nickname let title=`用户:${e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}的对话记录`let forwardMsg=[]for(var T1=0;T1<js['\x6c\x65\x6e\x67\x74\x68'];T1++){let userInfo let g if(js[T1]['\x72\x6f\x6c\x65']=="\x75\x73\x65\x72"){nickname=e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] userInfo={user_id:e['\x75\x73\x65\x72\x5f\x69\x64'],nickname}g=js[T1]['\x63\x6f\x6e\x74\x65\x6e\x74']}else{nickname=Bot['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] userInfo={user_id:Bot['\x75\x69\x6e'],nickname}g=js[T1]['\x63\x6f\x6e\x74\x65\x6e\x74']}let img={..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:g}forwardMsg['\x70\x75\x73\x68'](img)}if(e['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}else{let bn="\u5f53\u524d\u4f60\u6ca1\u6709\u4efb\u4f55\u804a\u5929\u8bb0\u5f55"e['\x72\x65\x70\x6c\x79'](bn,true)}}async gptfs(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt对话方式/g,"")['\x74\x72\x69\x6d']()console['\x6c\x6f\x67'](msg)if(!msg=="\u8f6c\u53d1"|"\u56fe\u7247"|"\u6587\u5b57"){e['\x72\x65\x70\x6c\x79']("\u4f60\u8f93\u5165\u7684\u4e0d\u5bf9\x2c\u652f\u6301\x33\u79cd\u65b9\u5f0f\x3a\u8f6c\u53d1\x3b\u56fe\u7247\x3b\u6587\u5b57\x3b")return false}else{if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x78":{"\x62\x6f\x74\x6e\x61\x6d\x65":"\x23\x67\x70\x74\x78","\x66\x73":msg}}))e['\x72\x65\x70\x6c\x79']("\u5bf9\u8bdd\u65b9\u5f0f\u6210\u529f\u66f4\u6539\x21")return false}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))let name=js['\x67\x70\x74\x78']['\x62\x6f\x74\x6e\x61\x6d\x65'] fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x78":{"\x62\x6f\x74\x6e\x61\x6d\x65":name,"\x66\x73":msg}}))e['\x72\x65\x70\x6c\x79']("\u5bf9\u8bdd\u65b9\u5f0f\u6210\u529f\u66f4\u6539\x21")return false}}}async gpthtzs(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#gpt设置绘图张数/g,"")['\x74\x72\x69\x6d']()htnum=window["\x4e\x75\x6d\x62\x65\x72"](msg['\x6d\x61\x74\x63\x68'](/\d+/g))if(htnum['\x6c\x65\x6e\x67\x74\x68']==-1){e['\x72\x65\x70\x6c\x79']("\u8f93\u5165\u7684\u6570\u5b57\u683c\u5f0f\u4e0d\u5bf9")return false}e['\x72\x65\x70\x6c\x79'](`gpt绘图张数已设置为:${htnum}`)}async gptgm(e){let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt改名/g,"")['\x74\x72\x69\x6d']()if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x78":{"\x62\x6f\x74\x6e\x61\x6d\x65":msg,"\x66\x73":"\u56fe\u7247"}}))}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))let gg=js['\x67\x70\x74\x78']['\x66\x73'] fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x78":{"\x62\x6f\x74\x6e\x61\x6d\x65":msg,"\x66\x73":gg}}))}e['\x72\x65\x70\x6c\x79']("\x67\x70\x74\u6539\u540d\u6210\u529f")}async gptht(e){if(typeof(htnum)=="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"){htnum=1}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt绘图/g,"")['\x74\x72\x69\x6d']()let b=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x74\x72\x61\x6e\x73\x6c\x61\x74\x65\x2d\x61\x70\x69\x2d\x66\x79\x6b\x7a\x2e\x78\x69\x61\x6e\x67\x74\x61\x74\x65\x63\x68\x2e\x63\x6f\x6d\x2f\x74\x72\x61\x6e\x73\x6c\x61\x74\x69\x6f\x6e\x2f\x77\x65\x62\x73\x2f\x69\x6e\x64\x65\x78",{"\x6d\x65\x74\x68\x6f\x64":"\x50\x4f\x53\x54","\x68\x65\x61\x64\x65\x72\x73":{"\x61\x63\x63\x65\x70\x74":"\x2a\x2f\x2a","\x61\x63\x63\x65\x70\x74\x2d\x6c\x61\x6e\x67\x75\x61\x67\x65":"\x7a\x68\x2d\x43\x4e\x2c\x7a\x68\x3b\x71\x3d\x30\x2e\x39\x2c\x65\x6e\x3b\x71\x3d\x30\x2e\x38\x2c\x65\x6e\x2d\x47\x42\x3b\x71\x3d\x30\x2e\x37\x2c\x65\x6e\x2d\x55\x53\x3b\x71\x3d\x30\x2e\x36","\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x74\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x2d\x77\x77\x77\x2d\x66\x6f\x72\x6d\x2d\x75\x72\x6c\x65\x6e\x63\x6f\x64\x65\x64",},"\x62\x6f\x64\x79":`appid=105&sgid=auto&sbid=auto&egid=en&ebid=en&content=${msg}&type=2`});b=await b['\x6a\x73\x6f\x6e']()console['\x6c\x6f\x67'](b)let by=await b['\x62\x79'] if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let key=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))apikey=key['\x67\x70\x74\x6b\x65\x79']['\x61\x70\x69\x6b\x65\x79']}let a=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x69\x6d\x61\x67\x65\x73\x2f\x67\x65\x6e\x65\x72\x61\x74\x69\x6f\x6e\x73",{method:"\x70\x6f\x73\x74",headers:{"\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x74\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e":"\x42\x65\x61\x72\x65\x72 "+apikey},body:JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x70\x72\x6f\x6d\x70\x74":by,"\x6e":htnum,})})a=await a['\x6a\x73\x6f\x6e']()console['\x6c\x6f\x67'](a)if(window["\x65\x76\x61\x6c"](htnum)>1){let nickname=e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let title="作品"let forwardMsg=[]let userInfo={user_id:e['\x75\x73\x65\x72\x5f\x69\x64'],nickname}for(var LqUHdcU2=0;LqUHdcU2<htnum;LqUHdcU2++){let data=await a['\x64\x61\x74\x61'][LqUHdcU2]['\x75\x72\x6c'] data=segment['\x69\x6d\x61\x67\x65'](data)let img={..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:data}forwardMsg['\x70\x75\x73\x68'](img)}if(e['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}else{let data=await a['\x64\x61\x74\x61'][0]['\x75\x72\x6c'] e['\x72\x65\x70\x6c\x79']([segment['\x69\x6d\x61\x67\x65'](data)])}}async gptys(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}let res=await fetch('\x68\x74\x74\x70\x73\x3a\x2f\x2f\x73\x68\x6f\x75\x71\x75\x61\x6e\x2d\x31\x33\x31\x35\x35\x34\x34\x35\x36\x32\x2e\x63\x6f\x73\x2e\x61\x70\x2d\x6e\x61\x6e\x6a\x69\x6e\x67\x2e\x6d\x79\x71\x63\x6c\x6f\x75\x64\x2e\x63\x6f\x6d\x2f\x73\x71\x71\x71\x2e\x6a\x73\x6f\x6e')res=await res['\x6a\x73\x6f\x6e']()res=await res['\x71\x71'] console['\x6c\x6f\x67'](res)if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u5207\u6362\u9884\u8bbe")){if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt切换预设/g,"")['\x74\x72\x69\x6d']()if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){let sg=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'],"\x75\x74\x66\x2d\x38")e['\x72\x65\x70\x6c\x79']("\u597d\u7684\uff0c\u7a0d\u7b49\u54e6\ud83c\udfc0\u8bf7\u7b49\u5f85\u56de\u590d\uff0c\u82e5\u56de\u590d\u6210\u529f\uff0c\u5219\u5207\u6362\u6210\u529f")history=[]if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let key=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))apikey=key['\x67\x70\x74\x6b\x65\x79']['\x61\x70\x69\x6b\x65\x79']}history['\x70\x75\x73\x68']({"\x72\x6f\x6c\x65":"\x75\x73\x65\x72","\x63\x6f\x6e\x74\x65\x6e\x74":sg})if(typeof(model)=="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"){model="\x67\x70\x74\x2d\x34\x2d\x70\x6f\x65"}let tokens=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x63\x68\x61\x74\x2f\x74\x6f\x6b\x65\x6e\x69\x7a\x65\x72",{method:"\x70\x6f\x73\x74",headers:{"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e":"\x42\x65\x61\x72\x65\x72 "+apikey},body:JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x6d\x6f\x64\x65\x6c":model,"\x6d\x65\x73\x73\x61\x67\x65\x73":history})})tokens=await tokens['\x6a\x73\x6f\x6e']()console['\x6c\x6f\x67'](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])if(model=="\x67\x70\x74\x2d\x34"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=8000){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="gpt-4-poe"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=2300){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return true}if(model=="ada"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=2049){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="babbage"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=2049){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="claude+"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=11000){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="claude-instant"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=11000){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="claude-instant-100k"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=100000){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="dragonfly"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=2400){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="sage"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=5200){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="text-embedding-ada-002"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=8191){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="gpt-3.5-turbo-poe"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=3000){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="gpt-3.5-turbo"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=3000){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}if(model=="text-devinci-003"&&window["\x65\x76\x61\x6c"](tokens['\x63\x68\x69\x6d\x65\x72\x61']['\x63\x6f\x75\x6e\x74'])>=4097){e['\x72\x65\x70\x6c\x79']("您的字数太多，token超过限制")return false}let response=await fetch("https://chimeragpt.adventblocks.cc/v1/chat/completions",{method:"post",headers:{accept:"application/json","Content-Type":"application/json","Authorization":"Bearer "+apikey},body:JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({model:model,messages:history})})response=await response['\x6a\x73\x6f\x6e']()let obj1=response['\x63\x68\x6f\x69\x63\x65\x73'][0]['\x6d\x65\x73\x73\x61\x67\x65'] let obj2={"role":"assistant"}let obj={..['\x6f\x62\x6a\x31'],..['\x6f\x62\x6a\x32']}history['\x70\x75\x73\x68'](obj)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"/"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'],JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](history))let answer=response['\x63\x68\x6f\x69\x63\x65\x73'][0]['\x6d\x65\x73\x73\x61\x67\x65']['\x63\x6f\x6e\x74\x65\x6e\x74'] if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"/data.json")){e['\x72\x65\x70\x6c\x79'](answer,true)return false}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"/data.json")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"/data.json"))let n=js['\x67\x70\x74\x78']['\x66\x73'] if(n=="文字"){e['\x72\x65\x70\x6c\x79'](answer,true)return false}if(n=="图片"){let r1=e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let r2=Bot['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let content=answer['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,"<br>")let js=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/html/gptx['\x68\x74\x6d\x6c\x60'],"utf-8")js=js['\x72\x65\x70\x6c\x61\x63\x65']("Content",content)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/html/gptx['\x68\x74\x6d\x6c\x60'],js,"utf-8")let data2={tplFile:`${_path}/plugins/y-tian-plugin/resources/html/gptx['\x68\x74\x6d\x6c\x60'],dz:`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],msg:msg,id2:Bot['\x75\x69\x6e'],id1:e['\x75\x73\x65\x72\x5f\x69\x64'],name:r1,name1:r2}let img=await puppeteer['\x73\x63\x72\x65\x65\x6e\x73\x68\x6f\x74']("777",{..['\x64\x61\x74\x61\x32'],});e['\x72\x65\x70\x6c\x79'](img)js=js['\x72\x65\x70\x6c\x61\x63\x65'](content,"\x43\x6f\x6e\x74\x65\x6e\x74")fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/html/gptx['\x68\x74\x6d\x6c\x60'],js,"\x75\x74\x66\x2d\x38")return true}if(n=="\u8f6c\u53d1"){let nickname=model let title="\x67\x70\x74\x78\u56de\u7b54"let forwardMsg=[]let userInfo={user_id:Bot['\x75\x69\x6e'],nickname}forwardMsg=[{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:answer}]if(e['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}}}else if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){e['\x72\x65\x70\x6c\x79']("\u5f53\u524d\u9884\u8bbe\u4e0d\u5b58\u5728\uff0c\u4e0d\u80fd\u4e71\u8f93\u5165\u54e6\u3002")}}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u9884\u8bbe\u5927\u5168")){let dir=fs['\x72\x65\x61\x64\x64\x69\x72\x53\x79\x6e\x63'](dirpath)let targetObj="\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"let index=dir['\x69\x6e\x64\x65\x78\x4f\x66'](targetObj)dir['\x73\x70\x6c\x69\x63\x65'](index,1)let length=dir['\x6c\x65\x6e\x67\x74\x68'] console['\x6c\x6f\x67'](dir)dir=JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](dir)['\x72\x65\x70\x6c\x61\x63\x65'](/['\x74\x78\x74']/g,"\x3b")['\x72\x65\x70\x6c\x61\x63\x65']("\x5b","")['\x72\x65\x70\x6c\x61\x63\x65']("\x5d","")['\x72\x65\x70\x6c\x61\x63\x65'](/,"\x2f\x67\x2c""\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f"/g,"")let gh=dir['\x73\x70\x6c\x69\x74']("\x3b")let c=[]let separator="\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013"let endSeparator="\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d"for(var Q$3=0;Q$3<length;Q$3++){let v=`\n${separator}\n${Q$3+1}:${gh[Q$3]}`c['\x70\x75\x73\x68'](v)}c=`${c}`let hd=[`当前共有${length}个设定:`,c,`\n${endSeparator}\n\u53ef\u7528#gpt查看设定\n${endSeparator}\n\u4f8b:#gpt查看设定魅魔\n${endSeparator}`]e['\x72\x65\x70\x6c\x79'](hd['\x6a\x6f\x69\x6e']("\n"))}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u67e5\u770b\u9884\u8bbe")){let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt查看预设/g,"")['\x74\x72\x69\x6d']()if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){let sg=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'],"\x75\x74\x66\x2d\x38")let nickname="\x67\x70\x74\u9884\u8bbe\u5927\u5168"let title="\x67\x70\x74\u9884\u8bbe\u5927\u5168"if(e['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}let userInfo={user_id:Bot['\x75\x69\x6e'],nickname}let forwardMsg=[{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:sg}]if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){e['\x72\x65\x70\x6c\x79']("\u5f53\u524d\u9884\u8bbe\u4e0d\u5b58\u5728")}}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u5220\u9664\u9884\u8bbe")){let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt删除预设/g,"")['\x74\x72\x69\x6d']()if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){e['\x72\x65\x70\x6c\x79']("\u6ca1\u6709\u8fd9\u4e2a\u9884\u8bbe\x2c\u4f60\u8f93\u9519\u4e86\u5427\uff1f")return false}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])e['\x72\x65\x70\x6c\x79'](`当前预设:${msg}已成功删除!`)}}}async jblx(e){if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\u66f4\u6539\u5267\u672c\u79cd\u7c7b")){type=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#更改剧本种类/g,"")['\x74\x72\x69\x6d']()let msg=`当前剧本类型已切换为:${type}`e['\x72\x65\x70\x6c\x79'](msg)return true}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\u5267\u672c\u79cd\u7c7b")){e['\x72\x65\x70\x6c\x79']("\u5f53\u524d\u5267\u672c\u6709\x3a\u7231\u60c5\x2c\u53e4\u88c5\x2c\u5947\u5e7b\x2c\u72af\u7f6a\x2c\u6218\u4e89\x2c\u60ca\u609a\x2c\u5386\u53f2\x2c\u5bb6\u5ead\x2e\n\u8bf7\u53d1\u9001\x23\u66f4\u6539\u5267\u672c\u7c7b\u578b\x2b\u5185\u5bb9\u4fee\u6539\x2c\u4f8b\u5982\x3a\x23\u66f4\u6539\u5267\u672c\u7c7b\u578b\u559c\u5267")}}async cts(e){let num;let lx;let words=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#藏头诗五言/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/#藏头诗七言/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/#藏尾诗五言/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/#藏尾诗七言/g,"")['\x74\x72\x69\x6d']()if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\u5934")){lx="\x73\x74\x61\x72\x74"}else{lx="\x65\x6e\x64"}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\u4e94\u8a00")){num=5}else{num=7}let a=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x74\x73\x2e\x63\x68\x61\x7a\x68\x69\x2e\x6e\x65\x74\x2f",{"\x6d\x65\x74\x68\x6f\x64":"\x50\x4f\x53\x54","\x68\x65\x61\x64\x65\x72\x73":{"\x61\x63\x63\x65\x70\x74":"\x2a\x2f\x2a","\x61\x63\x63\x65\x70\x74\x2d\x6c\x61\x6e\x67\x75\x61\x67\x65":"\x7a\x68\x2d\x43\x4e\x2c\x7a\x68\x3b\x71\x3d\x30\x2e\x39\x2c\x65\x6e\x3b\x71\x3d\x30\x2e\x38\x2c\x65\x6e\x2d\x47\x42\x3b\x71\x3d\x30\x2e\x37\x2c\x65\x6e\x2d\x55\x53\x3b\x71\x3d\x30\x2e\x36","\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x74\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x2d\x77\x77\x77\x2d\x66\x6f\x72\x6d\x2d\x75\x72\x6c\x65\x6e\x63\x6f\x64\x65\x64\x3b \x63\x68\x61\x72\x73\x65\x74\x3d\x55\x54\x46\x2d\x38","\x73\x65\x63\x2d\x63\x68\x2d\x75\x61":"\"\x4d\x69\x63\x72\x6f\x73\x6f\x66\x74 \x45\x64\x67\x65\"\x3b\x76\x3d\"\x31\x31\x33\"\x2c \"\x43\x68\x72\x6f\x6d\x69\x75\x6d\"\x3b\x76\x3d\"\x31\x31\x33\"\x2c \"\x4e\x6f\x74\x2d\x41\x2e\x42\x72\x61\x6e\x64\"\x3b\x76\x3d\"\x32\x34\"","\x73\x65\x63\x2d\x63\x68\x2d\x75\x61\x2d\x6d\x6f\x62\x69\x6c\x65":"\x3f\x30","\x73\x65\x63\x2d\x63\x68\x2d\x75\x61\x2d\x70\x6c\x61\x74\x66\x6f\x72\x6d":"\"\x57\x69\x6e\x64\x6f\x77\x73\"","\x73\x65\x63\x2d\x66\x65\x74\x63\x68\x2d\x64\x65\x73\x74":"\x65\x6d\x70\x74\x79","\x73\x65\x63\x2d\x66\x65\x74\x63\x68\x2d\x6d\x6f\x64\x65":"\x63\x6f\x72\x73","\x73\x65\x63\x2d\x66\x65\x74\x63\x68\x2d\x73\x69\x74\x65":"\x73\x61\x6d\x65\x2d\x6f\x72\x69\x67\x69\x6e","\x78\x2d\x72\x65\x71\x75\x65\x73\x74\x65\x64\x2d\x77\x69\x74\x68":"\x58\x4d\x4c\x48\x74\x74\x70\x52\x65\x71\x75\x65\x73\x74","\x52\x65\x66\x65\x72\x65\x72":"\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x74\x73\x2e\x63\x68\x61\x7a\x68\x69\x2e\x6e\x65\x74\x2f","\x52\x65\x66\x65\x72\x72\x65\x72\x2d\x50\x6f\x6c\x69\x63\x79":"\x73\x74\x72\x69\x63\x74\x2d\x6f\x72\x69\x67\x69\x6e\x2d\x77\x68\x65\x6e\x2d\x63\x72\x6f\x73\x73\x2d\x6f\x72\x69\x67\x69\x6e","\x75\x73\x65\x72\x2d\x61\x67\x65\x6e\x74":"\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30 \x28\x57\x69\x6e\x64\x6f\x77\x73 \x4e\x54 \x31\x30\x2e\x30\x3b \x57\x69\x6e\x36\x34\x3b \x78\x36\x34\x29 \x41\x70\x70\x6c\x65\x57\x65\x62\x4b\x69\x74\x2f\x35\x33\x37\x2e\x33\x36 \x28\x4b\x48\x54\x4d\x4c\x2c \x6c\x69\x6b\x65 \x47\x65\x63\x6b\x6f\x29 \x43\x68\x72\x6f\x6d\x65\x2f\x31\x31\x32\x2e\x30\x2e\x30\x2e\x30 \x53\x61\x66\x61\x72\x69\x2f\x35\x33\x37\x2e\x33\x36 \x45\x64\x67\x2f\x31\x31\x32\x2e\x30\x2e\x31\x37\x32\x32\x2e\x34\x36"},"\x62\x6f\x64\x79":`words=${words}&num=${num}&type=${lx}`});a=await a['\x6a\x73\x6f\x6e']()let da=await a['\x73\x75\x63\x63\x65\x73\x73'] da=`${da}`da=da['\x72\x65\x70\x6c\x61\x63\x65'](/<font color="\x28\x2e\x2a\x3f\x29">/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/<\/font>/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/<br\/>/g,"\n")['\x72\x65\x70\x6c\x61\x63\x65'](/,/g,"")e['\x72\x65\x70\x6c\x79'](da,true)}async jbsc(e){if(typeof(type)=="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"){type="\u559c\u5267"}let name=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?生成剧本/g,"")['\x74\x72\x69\x6d']()let data={"\x72\x6f\x6c\x65\x73":[name],"\x73\x63\x65\x6e\x61\x72\x69\x6f":type+"\u6545\u4e8b"}let a=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x64\x61\x74\x61\x6d\x75\x73\x65\x2e\x67\x75\x6f\x6b\x72\x2e\x63\x6f\x6d\x2f\x61\x70\x69\x2f\x6e\x65\x76\x65\x72\x2f\x63\x6f\x6d\x6d\x6f\x6e\x2f\x6d\x75\x73\x65\x2f\x74\x76\x2d\x63\x6f\x73\x6d\x6f\x73\x2f\x76\x31\x2f\x64\x72\x61\x6d\x61\x73",{"\x6d\x65\x74\x68\x6f\x64":"\x50\x4f\x53\x54","\x68\x65\x61\x64\x65\x72\x73":{"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x52\x65\x66\x65\x72\x65\x72":"\x68\x74\x74\x70\x73\x3a\x2f\x2f\x64\x61\x74\x61\x6d\x75\x73\x65\x2e\x67\x75\x6f\x6b\x72\x2e\x63\x6f\x6d\x2f\x6c\x74\x64","\x52\x65\x66\x65\x72\x72\x65\x72\x2d\x50\x6f\x6c\x69\x63\x79":"\x73\x74\x72\x69\x63\x74\x2d\x6f\x72\x69\x67\x69\x6e\x2d\x77\x68\x65\x6e\x2d\x63\x72\x6f\x73\x73\x2d\x6f\x72\x69\x67\x69\x6e","\x75\x73\x65\x72\x2d\x61\x67\x65\x6e\x74":"\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30 \x28\x57\x69\x6e\x64\x6f\x77\x73 \x4e\x54 \x31\x30\x2e\x30\x3b\x57\x69\x6e\x36\x34\x3b\x78\x36\x34\x29 \x41\x70\x70\x6c\x65\x57\x65\x62\x4b\x69\x74\x2f\x35\x33\x37\x2e\x33\x36 \x28\x4b\x48\x54\x4d\x4c\x2c \x6c\x69\x6b\x65 \x47\x65\x63\x6b\x6f\x29 \x43\x68\x72\x6f\x6d\x65\x2f\x31\x31\x32\x2e\x30\x2e\x30\x2e\x30 \x53\x61\x66\x61\x72\x69\x2f\x35\x33\x37\x2e\x33\x36 \x45\x64\x67\x2f\x31\x31\x32\x2e\x30\x2e\x31\x37\x32\x32\x2e\x34\x36"},"\x62\x6f\x64\x79":JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](data)});a=await a['\x6a\x73\x6f\x6e']()let drama=await a['\x64\x72\x61\x6d\x61'] drama=drama['\x72\x65\x70\x6c\x61\x63\x65'](/<strong>/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/<\/strong>/g,"")e['\x72\x65\x70\x6c\x79'](drama,true)}async changemodel(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt切换模型/g,"")['\x74\x72\x69\x6d']()if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])}if(msg==1){model="\x74\x65\x78\x74\x2d\x65\x6d\x62\x65\x64\x64\x69\x6e\x67\x2d\x61\x64\x61\x2d\x30\x30\x32"}if(msg==2){model="\x61\x64\x61"}if(msg==3){model="\x62\x61\x62\x62\x61\x67\x65"}if(msg==4){model="\x63\x6c\x61\x75\x64\x65\x2b"}if(msg==5){model="\x63\x6c\x61\x75\x64\x65\x2d\x69\x6e\x73\x74\x61\x6e\x74"}if(msg==6){model="\x63\x6c\x61\x75\x64\x65\x2d\x69\x6e\x73\x74\x61\x6e\x74\x2d\x31\x30\x30\x6b"}if(msg==7){model="\x64\x72\x61\x67\x6f\x6e\x66\x6c\x79"}if(msg==8){model="\x73\x61\x67\x65"}if(msg==9){model="\x67\x70\x74\x2d\x34"}if(msg==10){model="\x67\x70\x74\x2d\x34\x2d\x70\x6f\x65"}if(msg==11){model="\x67\x70\x74\x2d\x33\x2e\x35\x2d\x74\x75\x72\x62\x6f"}if(msg==12){model="\x67\x70\x74\x2d\x33\x2e\x35\x2d\x74\x75\x72\x62\x6f\x2d\x70\x6f\x65"}if(msg==13){model="\x74\x65\x78\x74\x2d\x64\x65\x76\x69\x6e\x63\x69\x2d\x30\x30\x33"}let ms=`gpt模型成功切换,现在为${model}`history=[]e['\x72\x65\x70\x6c\x79'](ms)}async jsdh(e){if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u5bf9\u8bdd\u7ed3\u675f")){if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])let mg=`用户【${e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}】已经重置对话了`e['\x72\x65\x70\x6c\x79'](mg,true)}else{e['\x72\x65\x70\x6c\x79']("\u60a8\u8fd8\u672a\u6709\u4efb\u4f55\u804a\u5929\u8bb0\u5f55")}}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u7ed3\u675f\u5168\u90e8\u5bf9\u8bdd")){if(!e['\x69\x73\x4d\x61\x73\x74\x65\x72']){e['\x72\x65\x70\x6c\x79']("\u4f60\u90a3\u6743\u9650\u4e0d\u591f")return false}let js=fs['\x72\x65\x61\x64\x64\x69\x72\x53\x79\x6e\x63'](dirpath2)let targetObj="\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"let index=js['\x69\x6e\x64\x65\x78\x4f\x66'](targetObj)js['\x73\x70\x6c\x69\x63\x65'](index,1)for(var PVy4=0;PVy4<js['\x6c\x65\x6e\x67\x74\x68'];PVy4++){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${js[PVy4]}`)}e['\x72\x65\x70\x6c\x79'](`全部对话已重置,已结束${js['\x6c\x65\x6e\x67\x74\x68']}个用户的对话`)}}async gptkey(e){this['\x73\x65\x74\x43\x6f\x6e\x74\x65\x78\x74']('\x53\x61\x76\x65\x4b\x65\x79')await this['\x72\x65\x70\x6c\x79']('\u8bf7\u53d1\u9001\x4b\x65\x79',true)return false}async SaveKey(e){if(!this['\x65']['\x6d\x73\x67'])return let token=this['\x65']['\x6d\x73\x67'] let headers={'\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e':'\x42\x65\x61\x72\x65\x72 '+token}try{await fetch('\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x69\x6e\x66\x6f',{headers:headers});}catch(error){await this['\x72\x65\x70\x6c\x79']('\u5bc6\u94a5\u9a8c\u8bc1\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u5bc6\u94a5\u662f\u5426\u6b63\u786e',true)this['\x66\x69\x6e\x69\x73\x68']('\x53\x61\x76\x65\x4b\x65\x79')return}fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x6b\x65\x79":{"\x61\x70\x69\x6b\x65\x79":token}}))await this['\x72\x65\x70\x6c\x79']('\x67\x70\x74\x6b\x65\x79\u8bbe\u7f6e\u6210\u529f',true)this['\x66\x69\x6e\x69\x73\x68']('\x53\x61\x76\x65\x4b\x65\x79')}async modelhp(e){await this['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](e)}async makeForwardMsg(e){let msg="\u9650\u5236\u6b21\u6570\x3a\x34\x30\x2f\x6d\x69\x6e"let msg1="\x31\x2c\x74\x65\x78\x74\x2d\x65\x6d\x62\x65\x64\x64\x69\x6e\x67\x2d\x61\x64\x61\x2d\x30\x30\x32\n\u6765\u6e90\x3a\x6f\x70\x65\x6e\x61\x69\n\u7c7b\u578b\x3a\x65\x6d\x62\x65\x64\x64\x69\x6e\x67\n\x74\x6f\x6b\x65\x6e\x73\x3a\x38\x31\x39\x31"let msg2="\x32\x2c\x61\x64\x61\n\u6765\u6e90\x3a\x6f\x70\x65\x6e\x61\x69\n\u7c7b\u578b\x3a\x63\x6f\x6d\x70\x6c\x65\x74\x69\x6f\x6e\n\x74\x6f\x6b\x65\x6e\x73\x3a\x32\x30\x34\x39"let title="\x67\x70\x74\x6d\x6f\x64\x65\x6c\u5927\u5168"let msg3="\x33\x2c\x62\x61\x62\x62\x61\x67\x65\n\u6765\u6e90\x3a\x6f\x70\x65\x6e\x61\x69\n\u7c7b\u578b\x3a\x63\x6f\x6d\x70\x6c\x65\x74\x69\x6f\x6e\n\x74\x6f\x6b\x65\x6e\x73\x3a\x32\x30\x34\x39"let msg4="\x34\x2c\x63\x6c\x61\x75\x64\x65\x2b\n\u6765\u6e90\x3a\x70\x6f\x65\n\u7c7b\u578b\x3a\x63\x68\x61\x74\n\x74\x6f\x6b\x65\x6e\x73\x3a\x31\x31\x30\x30\x30"let msg5="\x35\x2c\x63\x6c\x61\x75\x64\x65\x2d\x69\x6e\x73\x74\x61\x6e\x74\n\u6765\u6e90\x3a\x70\x6f\x65\n\u7c7b\u578b\x3a\x63\x68\x61\x74\n\x74\x6f\x6b\x65\x6e\x73\x3a\x31\x31\x30\x30\x30"let msg6="\x36\x2c\x63\x6c\x61\x75\x64\x65\x2d\x69\x6e\x73\x74\x61\x6e\x74\x2d\x31\x30\x30\x6b\n\u6765\u6e90\x3a\x70\x6f\x65\n\u7c7b\u578b\x3a\x63\x68\x61\x74\n\x74\x6f\x6b\x65\x6e\x73\x3a\x31\x30\x30\x30\x30\x30"let msg7="\x37\x2c\x64\x72\x61\x67\x6f\x6e\x66\x6c\x79\n\u6765\u6e90\x3a\x70\x6f\x65\n\u7c7b\u578b\x3a\x63\x68\x61\x74\n\x74\x6f\x6b\x65\x6e\x73\x3a\x32\x34\x30\x30"let msg8="\x38\x2c\x73\x61\x67\x65\n\u6765\u6e90\x3a\x70\x6f\x65\n\u7c7b\u578b\x3a\x63\x68\x61\x74\n\x74\x6f\x6b\x65\x6e\x73\x3a\x35\x32\x30\x30"let msg9="\x39\x2c\x67\x70\x74\x2d\x34\n\u6765\u6e90\x3a\x6f\x70\x65\x6e\x61\x69\n\u7c7b\u578b\x3a\x63\x68\x61\x74\n\x74\x6f\x6b\x65\x6e\x73\x3a\x32\x33\x30\x30"let msg10="\x31\x30\x2c\x67\x70\x74\x2d\x34\x2d\x70\x6f\x65\n\u6765\u6e90\x3a\x70\x6f\x65\n\u7c7b\u578b\x3a\x63\x68\x61\x74\n\x74\x6f\x6b\x65\x6e\x73\x3a\x32\x33\x30\x30"let msg11="\x31\x31\x2c\x67\x70\x74\x2d\x33\x2e\x35\x2d\x74\x75\x72\x62\x6f\n\u6765\u6e90\x3a\x6f\x70\x65\x6e\x61\x69\n\u7c7b\u578b\x3a\x63\x68\x61\x74\n\x74\x6f\x6b\x65\x6e\x73\x3a\x33\x30\x30\x30"let msg12="\x31\x32\x2c\x67\x70\x74\x2d\x33\x2e\x35\x2d\x74\x75\x72\x62\x6f\x2d\x70\x6f\x65\n\u6765\u6e90\x3a\x70\x6f\x65\n\u7c7b\u578b\x3a\x63\x6f\x6d\x70\x6c\x65\x74\x69\x6f\x6e\n\x74\x6f\x6b\x65\x6e\x73\x3a\x33\x30\x30\x30"let msg13="\x31\x33\x2c\x74\x65\x78\x74\x2d\x64\x65\x76\x69\x6e\x63\x69\x2d\x30\x30\x33\n\u6765\u6e90\x3a\x6f\x70\x65\x6e\x61\x69\n\u7c7b\u578b\x3a\x63\x6f\x6d\x70\x6c\x65\x74\x69\x6f\x6e\n\x74\x6f\x6b\x65\x6e\x73\x3a\x34\x30\x39\x37"let msg14="\u547d\u4ee4\x3a\x23\x67\x70\x74\u5207\u6362\u6a21\u578b\x2b\u5e8f\u53f7\x3b\u4f8b\x3a\x23\x67\x70\x74\u5207\u6362\u6a21\u578b\x31"let nickname=Bot['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}let userInfo={user_id:Bot['\x75\x69\x6e'],nickname}let forwardMsg=[{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg1},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg2},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg3},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg4},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg5},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg6},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg7},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg8},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg9},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg10},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg11},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg12},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg13},{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:msg14}]if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}async gptx(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}if(e['\x6d\x65\x73\x73\x61\x67\x65']){if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))botname=js['\x67\x70\x74\x78']['\x62\x6f\x74\x6e\x61\x6d\x65']}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u65b0\u589e\u9884\u8bbe")){let m=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#gpt新增预设/g,"")['\x74\x72\x69\x6d']()let ms=m['\x73\x70\x6c\x69\x74']("\x2f")let txt=ms[1]console['\x6c\x6f\x67'](ms[0])ms=`${ms[0]}`txt=`${txt}`fs['\x61\x70\x70\x65\x6e\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f"+`${ms}['\x74\x78\x74\x60'],txt)e['\x72\x65\x70\x6c\x79'](`Gpt新增预设:\n[${ms}]`)return false}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73'](botname)){if(CD[e['\x75\x73\x65\x72\x5f\x69\x64']]&&GetCD===true&&!e['\x69\x73\x4d\x61\x73\x74\x65\x72']){e['\x72\x65\x70\x6c\x79']("\u9664\u4e86\u4e3b\u4eba\u4e4b\u5916\x2c\u5176\u4ed6\u4eba\u6bcf\x32\u5206\u949f\u6700\u591a\u4e00\u6b21\u95ee\u7b54");return false}CD[e['\x75\x73\x65\x72\x5f\x69\x64']]=true;CD[e['\x75\x73\x65\x72\x5f\x69\x64']]=setTimeout(()=>{if(CD[e['\x75\x73\x65\x72\x5f\x69\x64']]){delete CD[e['\x75\x73\x65\x72\x5f\x69\x64']];}},CDTime);if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let key=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))apikey=key['\x67\x70\x74\x6b\x65\x79']['\x61\x70\x69\x6b\x65\x79']}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](botname,"")['\x74\x72\x69\x6d']()if(e['\x6d\x65\x73\x73\x61\x67\x65']['\x66\x69\x6e\x64'](val=>val['\x74\x79\x70\x65']==='\x69\x6d\x61\x67\x65')){}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])){history=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'],"\x75\x74\x66\x2d\x38")history=JSON['\x70\x61\x72\x73\x65'](history)}else{history=[]}history['\x70\x75\x73\x68']({"\x72\x6f\x6c\x65":"\x75\x73\x65\x72","\x63\x6f\x6e\x74\x65\x6e\x74":msg})if(typeof(model)=="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"){model="\x67\x70\x74\x2d\x34\x2d\x70\x6f\x65"}let response=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x63\x68\x61\x74\x2f\x63\x6f\x6d\x70\x6c\x65\x74\x69\x6f\x6e\x73",{method:"\x70\x6f\x73\x74",headers:{accept:"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e":"\x42\x65\x61\x72\x65\x72 "+apikey},body:JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({model:model,messages:history})})response=await response['\x6a\x73\x6f\x6e']()console['\x6c\x6f\x67'](response['\x63\x68\x6f\x69\x63\x65\x73'][0]['\x6d\x65\x73\x73\x61\x67\x65'])let obj1=response['\x63\x68\x6f\x69\x63\x65\x73'][0]['\x6d\x65\x73\x73\x61\x67\x65'] let obj2={"\x72\x6f\x6c\x65":"\x61\x73\x73\x69\x73\x74\x61\x6e\x74"}let obj={..['\x6f\x62\x6a\x31'],..['\x6f\x62\x6a\x32']}history['\x70\x75\x73\x68'](obj)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'],JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](history))let answer=response['\x63\x68\x6f\x69\x63\x65\x73'][0]['\x6d\x65\x73\x73\x61\x67\x65']['\x63\x6f\x6e\x74\x65\x6e\x74'] console['\x6c\x6f\x67'](response['\x63\x68\x6f\x69\x63\x65\x73'][0]['\x6d\x65\x73\x73\x61\x67\x65'])if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){e['\x72\x65\x70\x6c\x79'](answer,true)return false}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))let n=js['\x67\x70\x74\x78']['\x66\x73'] if(n=="\u6587\u5b57"){e['\x72\x65\x70\x6c\x79'](answer,true)return false}if(n=="\u56fe\u7247"){let r1=e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let r2=Bot['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let content=answer['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,"\x3c\x62\x72\x3e")let js=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/html/gptx['\x68\x74\x6d\x6c\x60'],"\x75\x74\x66\x2d\x38")js=js['\x72\x65\x70\x6c\x61\x63\x65']("\x43\x6f\x6e\x74\x65\x6e\x74",content)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/html/gptx['\x68\x74\x6d\x6c\x60'],js,"\x75\x74\x66\x2d\x38")let data2={tplFile:`${_path}/plugins/y-tian-plugin/resources/html/gptx['\x68\x74\x6d\x6c\x60'],dz:`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],msg:msg,id2:Bot['\x75\x69\x6e'],id1:e['\x75\x73\x65\x72\x5f\x69\x64'],name:r1,name1:r2}let img=await puppeteer['\x73\x63\x72\x65\x65\x6e\x73\x68\x6f\x74']("\x37\x37\x37",{..['\x64\x61\x74\x61\x32'],});e['\x72\x65\x70\x6c\x79'](img)js=js['\x72\x65\x70\x6c\x61\x63\x65'](content,"\x43\x6f\x6e\x74\x65\x6e\x74")fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/html/gptx['\x68\x74\x6d\x6c\x60'],js,"\x75\x74\x66\x2d\x38")return true}if(n=="\u8f6c\u53d1"){let nickname=model let title="\x67\x70\x74\x78\u56de\u7b54"let forwardMsg=[]let userInfo={user_id:Bot['\x75\x69\x6e'],nickname}forwardMsg=[{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:answer}]if(e['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}if(n=="\u89c6\u9891"){let url=`https:let response=await fetch(url)let buff=await response['\x61\x72\x72\x61\x79\x42\x75\x66\x66\x65\x72']();fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63']("\x6d\x61\x6f\x2e\x6d\x70\x33",Buffer['\x66\x72\x6f\x6d'](buff),"\x62\x69\x6e\x61\x72\x79",);var fKo5=require('\x63\x68\x69\x6c\x64\x5f\x70\x72\x6f\x63\x65\x73\x73')['\x65\x78\x65\x63'];let o=_path+`/resources/${e['\x75\x73\x65\x72\x5f\x69\x64']}/1['\x6d\x70\x33\x60\x6c\x65\x74'] image=segment['\x69\x6d\x61\x67\x65'](`http:var JuAj6=fKo5(`ffmpeg-r 15-t 15-f image2-loop 1-T1 mao['\x70\x6e\x67']-T1 mao['\x6d\x70\x33'] mao['\x6d\x70\x34']-y`,function(RayvtEglH7,GuGYqMzRj8,ygRdcVLc9){if(RayvtEglH7){e['\x72\x65\x70\x6c\x79']("\u5931\u8d25\u4e86\uff01");}else{var w10=fKo5("\x66\x66\x6d\x70\x65\x67 \x2d\x69 \x6d\x61\x6f\x2e\x6d\x70\x34 \x2d\x69 \x6d\x61\x6f\x2e\x6a\x70\x67 \x2d\x6d\x61\x70 \x31 \x2d\x6d\x61\x70 \x30 \x2d\x63 \x63\x6f\x70\x79 \x2d\x64\x69\x73\x70\x6f\x73\x69\x74\x69\x6f\x6e\x3a\x30 \x61\x74\x74\x61\x63\x68\x65\x64\x5f\x70\x69\x63 \x6f\x75\x74\x2e\x6d\x70\x34 \x2d\x79",function(PIcp_q11,_P12,qMMMvaFo13){if(PIcp_q11){e['\x72\x65\x70\x6c\x79']("\u5931\u8d25\u4e86\uff01");}else{let path=_path+"\x2f\x6f\x75\x74\x2e\x6d\x70\x34"e['\x72\x65\x70\x6c\x79']([segment['\x76\x69\x64\x65\x6f'](path)])}})}})}}}return false}}}