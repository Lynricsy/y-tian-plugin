import plugin from'\x2e\x2e\x2f\x2e\x2e\x2f\x2e\x2e\x2f\x6c\x69\x62\x2f\x70\x6c\x75\x67\x69\x6e\x73\x2f\x70\x6c\x75\x67\x69\x6e\x2e\x6a\x73'import cfg from'\x2e\x2e\x2f\x2e\x2e\x2f\x2e\x2e\x2f\x6c\x69\x62\x2f\x63\x6f\x6e\x66\x69\x67\x2f\x63\x6f\x6e\x66\x69\x67\x2e\x6a\x73'import{createRequire}from"\x6d\x6f\x64\x75\x6c\x65";import common from"\x2e\x2e\x2f\x2e\x2e\x2f\x2e\x2e\x2f\x6c\x69\x62\x2f\x63\x6f\x6d\x6d\x6f\x6e\x2f\x63\x6f\x6d\x6d\x6f\x6e\x2e\x6a\x73"const require=createRequire(import['\x6d\x65\x74\x61']['\x75\x72\x6c']);import fetch from'\x6e\x6f\x64\x65\x2d\x66\x65\x74\x63\x68'import fs from"\x66\x73"const _path=process['\x63\x77\x64']();import puppeteer from'\x2e\x2e\x2f\x2e\x2e\x2f\x2e\x2e\x2f\x6c\x69\x62\x2f\x70\x75\x70\x70\x65\x74\x65\x65\x72\x2f\x70\x75\x70\x70\x65\x74\x65\x65\x72\x2e\x6a\x73'import request from"\x2e\x2e\x2f\x6e\x6f\x64\x65\x5f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x72\x65\x71\x75\x65\x73\x74\x2f\x69\x6e\x64\x65\x78\x2e\x6a\x73"let apikey;let model;let type;let CD={};let musickey=0 let htnum let voice let history=[]let history2=false let botname="\x23\x67\x70\x74\x78"let GetCD=true;let CDTime=120000;let AK="\x55\x52\x6d\x71\x4c\x56\x78\x4b\x43\x47\x35\x68\x6d\x32\x37\x62\x74\x41\x67\x64\x54\x70\x65\x75"let SK="\x35\x34\x34\x30\x35\x7a\x4f\x54\x64\x44\x57\x73\x6e\x6b\x76\x79\x75\x70\x54\x43\x44\x42\x70\x48\x58\x6f\x67\x47\x75\x31\x39\x70"let dirpath=_path+'\x2f\x70\x6c\x75\x67\x69\x6e\x73\x2f\x79\x2d\x74\x69\x61\x6e\x2d\x70\x6c\x75\x67\x69\x6e\x2f\x67\x70\x74\x78\x6d\x6f\x64\x65\x6c\x2f\x67\x70\x74\x79\x73'let dirpath2=_path+'\x2f\x70\x6c\x75\x67\x69\x6e\x73\x2f\x79\x2d\x74\x69\x61\x6e\x2d\x70\x6c\x75\x67\x69\x6e\x2f\x67\x70\x74\x78\x6d\x6f\x64\x65\x6c\x2f\x67\x70\x74\x68\x69\x73\x74\x6f\x72\x79'if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath)){fs['\x6d\x6b\x64\x69\x72\x53\x79\x6e\x63'](dirpath)}if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2)){fs['\x6d\x6b\x64\x69\x72\x53\x79\x6e\x63'](dirpath2)}async function setName(){if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))botname=js['\x67\x70\x74\x78']['\x62\x6f\x74\x6e\x61\x6d\x65']}}await setName()let res=await fetch(`http:res=await res['\x74\x65\x78\x74']()if(res=="\x34\x30\x33"||res==403){apikey="\x31\x31\x34\x35\x31\x34"}else{apikey=res}export class example extends plugin{constructor(){super({name:'\u9634\u5929\x5b\x67\x70\x74\x5d',dsc:'\x67\x70\x74\x78\x78',event:'\x6d\x65\x73\x73\x61\x67\x65',priority:111,rule:[{reg:'\x5e\x23\x28\x67\x70\x74\u6a21\u578b\x7c\u6a21\u578b\x29\x3f\x28\u5927\u5168\x7c\u603b\u89c8\x29\x24',fnc:'\x6d\x6f\x64\x65\x6c\x68\x70'},{reg:'\x5e\x23\x67\x70\x74\u5207\u6362\u6a21\u578b\x28\x2e\x2a\x29\x24',fnc:'\x63\x68\x61\x6e\x67\x65\x6d\x6f\x64\x65\x6c'},{reg:'\x5e\x23\u586b\u5199\x67\x70\x74\x6b\x65\x79\x24',fnc:'\x67\x70\x74\x6b\x65\x79'},{reg:'\x5e\x23\x67\x70\x74\u5bf9\u8bdd\u65b9\u5f0f\x28\x2e\x2a\x29\x24',fnc:'\x67\x70\x74\x66\x73'},{reg:'\x5e\x23\x67\x70\x74\u5bf9\u8bdd\u7ed3\u675f\x24\x7c\x5e\x23\x67\x70\x74\u7ed3\u675f\u5168\u90e8\u5bf9\u8bdd\x24',fnc:'\x6a\x73\x64\x68'},{reg:'\x5e\x23\u751f\u6210\u5267\u672c\x28\x2e\x2a\x29\x24',fnc:'\x6a\x62\x73\x63'},{reg:'\x5e\x23\u66f4\u6539\u5267\u672c\u79cd\u7c7b\x28\x2e\x2a\x29\x24\x7c\x23\u5267\u672c\u79cd\u7c7b\x24',fnc:'\x6a\x62\x6c\x78'},{reg:'\x5e\x23\u85cf\u5934\u8bd7\u4e94\u8a00\x28\x2e\x2a\x29\x24\x7c\x5e\x23\u85cf\u5934\u8bd7\u4e03\u8a00\x28\x2e\x2a\x29\x24\x7c\x5e\x23\u85cf\u5c3e\u8bd7\u4e94\u8a00\x28\x2e\x2a\x3f\x29\x24\x7c\x5e\x23\u85cf\u5c3e\u8bd7\u4e03\u8a00\x28\x2e\x2a\x3f\x29\x24',fnc:'\x63\x74\x73'},{reg:'\x5e\x23\x67\x70\x74\u5207\u6362\u9884\u8bbe\x28\x2e\x2a\x29\x24\x7c\x5e\x23\x67\x70\x74\u9884\u8bbe\u5927\u5168\x28\x2e\x2a\x29\x24\x7c\x5e\x23\x67\x70\x74\u67e5\u770b\u9884\u8bbe\x28\x2e\x2a\x29\x24\x7c\x5e\x23\x67\x70\x74\u5220\u9664\u9884\u8bbe\x28\x2e\x2a\x29\x24',fnc:'\x67\x70\x74\x79\x73'},{reg:'\x5e\x23\x67\x70\x74\u5168\u5c40\u5207\u6362\u9884\u8bbe\x28\x2e\x2a\x29\x24',fnc:'\x67\x70\x74\x71\x6a\x79\x73'},{reg:`^${botname}(.*)|#gpt新增预设(.*)`,fnc:'\x67\x70\x74\x78'},{reg:'\x5e\x23\x67\x70\x74\u6539\u540d\x28\x2e\x2a\x3f\x29\x24',fnc:'\x67\x70\x74\x67\x6d'},{reg:'\x5e\x23\x67\x70\x74\u7ed8\u56fe\x28\x2e\x2a\x3f\x29\x24',fnc:'\x67\x70\x74\x68\x74'},{reg:'\x5e\x23\x67\x70\x74\u8bbe\u7f6e\u7ed8\u56fe\u5f20\u6570\x28\x2e\x2a\x3f\x29\x24',fnc:'\x67\x70\x74\x68\x74\x7a\x73'},{reg:'\x5e\x23\x67\x70\x74\x3f\x28\u6253\u5370\x7c\u67e5\u770b\x29\x3f\x28\u8bb0\u5f55\x7c\u5386\u53f2\x29\x24',fnc:'\x67\x70\x74\x6a\x6c'},{reg:'\x5e\x23\x67\x70\x74\u53d1\u97f3\u4eba\x3f\x28\u5927\u5168\x7c\u5217\u8868\x29\x7c\x23\x67\x70\x74\u5207\u6362\u53d1\u97f3\u4eba\x28\x2e\x2a\x3f\x29\x24',fnc:'\x67\x70\x74\x6d\x75\x73\x69\x63'},{reg:'\x5e\x23\x67\x70\x74\u5f00\u542f\u8bed\u97f3\x7c\x23\x67\x70\x74\u5173\u95ed\u8bed\u97f3\x24',fnc:'\x67\x70\x74\x6d\x75\x73\x69\x63\x32'},{reg:'\x5e\x23\u8bbe\u7f6e\u7528\u6237\u6846\u989c\u8272\x28\x2e\x2a\x29\x24\x7c\x5e\x23\u8bbe\u7f6e\u56de\u590d\u6846\u989c\u8272\x28\x2e\x2a\x29\x24',fnc:'\x64\x68\x6b'}]})}async gptmusic2(e){if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u5f00\u542f\u8bed\u97f3")){musickey=1 e['\x72\x65\x70\x6c\x79']("\x67\x70\x74\u5df2\u5f00\u542f\u8bed\u97f3\u6a21\u5f0f")}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u5173\u95ed\u8bed\u97f3")){musickey=0 e['\x72\x65\x70\x6c\x79']("\x67\x70\x74\u5df2\u5173\u95ed\u8bed\u97f3\u6a21\u5f0f")}}async gptmusic(e){let music=[{id:1,name:"\u751c\u7f8e\u5973\u795e\u5c0f\u73b2",voiceId:"\x7a\x68\x69\x6c\x69\x6e\x67\x66\x61",type:"\u5973\u58f0\uff0c\u4e2d\u82f1\u6df7"},{id:2,name:"\u81ea\u7136 \u6e29\u67d4\u5973\u58f0\u5c0f\u5170",voiceId:"\x67\x71\x6c\x61\x6e\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:3,name:"\u6807\u51c6\u5973\u58f0\u5c0f\u6d69",voiceId:"\x6c\x75\x63\x79\x66\x61",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:4,name:"\u6e05\u8106\u5973\u58f0\u5c0f\u9896",voiceId:"\x6c\x7a\x79\x69\x6e\x66\x61",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:5,name:"\u5c0f\u8bf4\u5973\u58f0\u5c0f\u59ae",voiceId:"\x68\x79\x61\x6e\x69\x66\x61",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:6,name:"\u98d8\u9038\u5973\u58f0\u5c0f\u9759",voiceId:"\x78\x6a\x69\x6e\x67\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:7,name:"\u6e05\u7eaf\u5973\u58f0\u8003\u62c9",voiceId:"\x6b\x61\x6f\x6c\x61\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:8,name:"\u6e05\u4eae\u5973\u58f0\u5c0f\u6d01",voiceId:"\x73\x6d\x6a\x69\x65\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:9,name:"\u5973\u8001\u5e08\u98ce\u541f",voiceId:"\x66\x65\x79\x69\x6e\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:10,name:"\u5546\u52a1\u5973\u58f0\u7483\u7483",voiceId:"\x6c\x69\x6c\x69\x31\x66\x5f\x73\x68\x61\x6e\x67\x77\x75",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:11,name:"\u5973\u8001\u5e08\u884c\u8005",voiceId:"\x78\x69\x7a\x68\x65\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:12,name:"\u5973\u5b66\u751f\u521d\u9633",voiceId:"\x63\x79\x61\x6e\x67\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:13,name:"\u5a31\u62a5\u5973\u58f0\u7483\u7483",voiceId:"\x6c\x69\x6c\x69\x31\x66\x5f\x79\x75\x62\x6f",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:14,name:"\u6807\u51c6\u5973\u58f0\u5b89\u5b81",voiceId:"\x61\x6e\x69\x6e\x67\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:15,name:"\u77e5\u6027\u5973\u58f0\u6676\u6676",voiceId:"\x6a\x6a\x69\x6e\x67\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:16,name:"\u6807\u51c6\u5973\u58f0\u84dd\u96e8",voiceId:"\x6c\x61\x6e\x79\x75\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:17,name:"\u7535\u53f0\u5973\u58f0\u7483\u7483",voiceId:"\x6c\x69\x6c\x69\x31\x66\x5f\x64\x69\x61\x6e\x74\x61\x69",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:18,name:"\u6807\u51c6\u5973\u58f0\u5c0f\u5996",voiceId:"\x78\x69\x79\x61\x6f\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:19,name:"\u6e05\u65b0\u5973\u58f0\u5c0f\u5996\x78\x69\x79\x61\x6f\x66\x5f\x71\x69\x6e\x67\x69\x78\x6e",voiceId:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:20,name:"\u5973\u58f0\u6768\u963f\u59e8",voiceId:"\x79\x61\x61\x79\x69\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:21,name:"\u6807\u51c6\u5973\u58f0\u6731\u682a\u513f",voiceId:"\x7a\x7a\x68\x65\x72\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:22,name:"\u9b3c\u6545\u4e8b\u7edd\u97f3\x6a\x75\x79\x69\x6e\x66\x5f\x67\x75\x69\x67\x75\x73\x68\x69",voiceId:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:23,name:"\u6545\u4e8b\u5973\u58f0\u5c0f\u9759\x78\x6a\x69\x6e\x67\x66\x5f\x67\x75\x73\x68\x69",voiceId:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:24,name:"\u6545\u4e8b\u5973\u58f0\u7816\u7816",voiceId:"\x7a\x7a\x68\x75\x61\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:25,name:"\u9ad8\u51b7\u5973\u58f0\u96f6\u516b\x6c\x69\x6e\x62\x61\x66\x5f\x67\x61\x6f\x6c\x65\x6e\x67",voiceId:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:26,name:"\u6e05\u65b0\u5973\u58f0\u96f6\u516b\x6c\x69\x6e\x62\x61\x66\x5f\x71\x69\x6e\x67\x78\x69\x6e",voiceId:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:27,name:"\u5973\u8001\u5e08\u5c0f\u5996",voiceId:"\x78\x69\x79\x61\x6f\x66\x5f\x6c\x61\x6f\x73\x68\x69",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:28,name:"\u6807\u51c6\u5973\u58f0\u7476\u7476",voiceId:"\x6c\x75\x79\x61\x6f\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:29,name:"\u6807\u51c6\u5973\u58f0\u6676\u6676",voiceId:"\x6a\x6a\x69\x6e\x67\x66",type:"\u5973\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:30,name:"\u751c\u7f8e\u5973\u795e\u5c0f\u73b2",voiceId:"\x7a\x68\x69\x6c\x69\x6e\x67\x66",type:"\u5973\u58f0\uff0c\u4f20\u7edf \u4e2d\u82f1\u6df7"},{id:31,name:"\u90bb\u5bb6\u5973\u58f0\u5c0f\u59ae",voiceId:"\x68\x79\x61\x6e\x69\x66",type:"\u5973\u58f0\uff0c\u4f20\u7edf"},{id:32,name:"\u6807\u51c6\u7537\u7ae5\u5802\u5802",voiceId:"\x62\x6f\x79",type:"\u7ae5\u58f0\uff0c\u81ea\u7136 \u4e2d\u82f1\u6df7"},{id:33,name:"\u53ef\u7231\u5973\u7ae5\u7136\u7136",voiceId:"\x71\x69\x61\x6e\x72\x61\x6e\x66",type:"\u7ae5\u58f0\uff0c\u4f20\u7edf \u4e2d\u82f1\u6df7"},{id:34,name:"\u53ef\u7231\u7537\u7ae5\u8fde\u8fde",voiceId:"\x6c\x7a\x6c\x69\x61\x66",type:"\u7ae5\u58f0\uff0c\u4f20\u7edf \u4e2d\u82f1\u6df7"},{id:35,name:"\u6807\u51c6\u5973\u7ae5\u4f5a\u4f5a",voiceId:"\x61\x6e\x6f\x6e\x79\x67",type:"\u7ae5\u58f0\uff0c\u4f20\u7edf"}]if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u53d1\u97f3\u4eba\u5927\u5168")|e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u53d1\u97f3\u4eba\u5217\u8868")){let nickname=Bot['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let title="\x67\x70\x74\u6a21\u578b\u5927\u5168"if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}let userInfo={user_id:Bot['\x75\x69\x6e'],nickname}let forwardMsg=[]for(var OvhAZtyW1=0;OvhAZtyW1<music['\x6c\x65\x6e\x67\x74\x68'];OvhAZtyW1++){let k="\x69\x64\x3a"+music[OvhAZtyW1]['\x69\x64']+"\n\u540d\u79f0\x3a"+music[OvhAZtyW1]['\x6e\x61\x6d\x65']+"\n\u53d1\u8a00\u4eba\x49\x44\x3a"+music[OvhAZtyW1]['\x76\x6f\x69\x63\x65\x49\x64']+"\n\u7c7b\u578b\x3a"+music[OvhAZtyW1]['\x74\x79\x70\x65'] let nr={..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:k}forwardMsg['\x70\x75\x73\x68'](nr)}let t={..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:"\u8bf7\u53d1\u9001\x23\x67\x70\x74\u5207\u6362\u53d1\u97f3\u4eba\x2b\x69\x64\u6765\u5207\u6362"}forwardMsg['\x70\x75\x73\x68'](t)if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u5207\u6362\u53d1\u97f3\u4eba")){let id=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#gpt切换发音人/g,"")['\x74\x72\x69\x6d']()voice=music[id-1]['\x76\x6f\x69\x63\x65\x49\x64'] let nnn=music[id-1]['\x6e\x61\x6d\x65'] e['\x72\x65\x70\x6c\x79'](`切换完毕,现在发言人为${nnn}`)}}async gptqjys(e){if(!e['\x69\x73\x4d\x61\x73\x74\x65\x72']){e['\x72\x65\x70\x6c\x79']("\u4f60\u65e0\u6743\u5207\u6362\u5168\u5c40\u9884\u8bbe")return false}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt全局切换预设/g,"")['\x74\x72\x69\x6d']()if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){e['\x72\x65\x70\x6c\x79']("\u4e0d\u5b58\u5728\u5f53\u524d\u9884\u8bbe")return false}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){history=[]let key=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))apikey=key['\x67\x70\x74\x6b\x65\x79']['\x61\x70\x69\x6b\x65\x79']}let sg=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'],"\x75\x74\x66\x2d\x38")history['\x70\x75\x73\x68']({"\x72\x6f\x6c\x65":"\x73\x79\x73\x74\x65\x6d","\x63\x6f\x6e\x74\x65\x6e\x74":sg})if(typeof(model)=="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"){model="\x67\x70\x74\x2d\x34"}let tokens=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x63\x68\x61\x74\x2f\x74\x6f\x6b\x65\x6e\x69\x7a\x65\x72",{method:"\x70\x6f\x73\x74",headers:{"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e":"\x42\x65\x61\x72\x65\x72 "+apikey},body:JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x6d\x6f\x64\x65\x6c":model,"\x6d\x65\x73\x73\x61\x67\x65\x73":history})})tokens=await tokens['\x6a\x73\x6f\x6e']()let res=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x6d\x6f\x64\x65\x6c\x73")res=await res['\x6a\x73\x6f\x6e']()let content=await res['\x64\x61\x74\x61'] let now=content['\x66\x69\x6e\x64\x49\x6e\x64\x65\x78'](item=>item['\x69\x64']==model)let xian=JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](content[now]['\x74\x6f\x6b\x65\x6e\x73'])if(window["\x4e\x75\x6d\x62\x65\x72"](xian)<=window["\x4e\x75\x6d\x62\x65\x72"](JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](tokens['\x73\x74\x72\x69\x6e\x67']['\x63\x6f\x75\x6e\x74']))){let yyy=`当前预设占用tokens:${tokens['\x73\x74\x72\x69\x6e\x67']['\x63\x6f\x75\x6e\x74']}大于当前模型tokens:${xian},请减少预设内容`e['\x72\x65\x70\x6c\x79'](yyy,true)return false}history2=sg e['\x72\x65\x70\x6c\x79']("\u5df2\u7ecf\u6210\u529f\u5207\u6362\u5168\u5c40\u9884\u8bbe")}}async dhk(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\u8bbe\u7f6e\u7528\u6237\u6846\u989c\u8272")){let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#设置用户框颜色/g,"")['\x74\x72\x69\x6d']()let js=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],"\x75\x74\x66\x2d\x38")let gh=js['\x6d\x61\x74\x63\x68'](/background-color:(.*?);/g)console['\x6c\x6f\x67'](gh[1])js=js['\x72\x65\x70\x6c\x61\x63\x65'](gh[1],`background-color:${msg};`)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],js,"\x75\x74\x66\x2d\x38")e['\x72\x65\x70\x6c\x79']("\u7528\u6237\u6846\u989c\u8272\u6210\u529f\u4fee\u6539\x21")}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\u8bbe\u7f6e\u56de\u590d\u6846\u989c\u8272")){let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#设置回复框颜色/g,"")['\x74\x72\x69\x6d']()let js=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],"\x75\x74\x66\x2d\x38")let gh=js['\x6d\x61\x74\x63\x68'](/background-color:(.*?);/g)console['\x6c\x6f\x67'](gh[2])js=js['\x72\x65\x70\x6c\x61\x63\x65'](gh[2],`background-color:${msg};`)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],js,"\x75\x74\x66\x2d\x38")e['\x72\x65\x70\x6c\x79']("\u56de\u590d\u6846\u989c\u8272\u6210\u529f\u4fee\u6539\x21")}}async gptjl(e){if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60']))console['\x6c\x6f\x67'](js)let nickname let title=`用户:${e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}的对话记录`let forwardMsg=[]for(var u2=0;u2<js['\x6c\x65\x6e\x67\x74\x68'];u2++){let userInfo let g if(js[u2]['\x72\x6f\x6c\x65']=="\x75\x73\x65\x72"){nickname=e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] userInfo={user_id:e['\x75\x73\x65\x72\x5f\x69\x64'],nickname}g=js[u2]['\x63\x6f\x6e\x74\x65\x6e\x74']}else{nickname=Bot['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] userInfo={user_id:Bot['\x75\x69\x6e'],nickname}g=js[u2]['\x63\x6f\x6e\x74\x65\x6e\x74']}let img={..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:g}forwardMsg['\x70\x75\x73\x68'](img)}if(e['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}else{let bn="\u5f53\u524d\u4f60\u6ca1\u6709\u4efb\u4f55\u804a\u5929\u8bb0\u5f55"e['\x72\x65\x70\x6c\x79'](bn,true)}}async gptfs(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}if(!e['\x69\x73\x4d\x61\x73\x74\x65\x72']){e['\x72\x65\x70\x6c\x79']("\u4f60\u7684\u6743\u9650\u4e0d\u591f")return false}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#gpt对话方式/g,"")['\x74\x72\x69\x6d']()if(msg!=="\u8f6c\u53d1"&&msg!=="\u56fe\u7247"&&msg!=="\u6587\u5b57"){e['\x72\x65\x70\x6c\x79']("\u4f60\u8f93\u5165\u7684\u4e0d\u5bf9\x2c\u652f\u6301\x33\u79cd\u65b9\u5f0f\x3a\u8f6c\u53d1\x3b\u56fe\u7247\x3b\u6587\u5b57\x3b")return false}else{if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x78":{"\x62\x6f\x74\x6e\x61\x6d\x65":"\x23\x67\x70\x74\x78","\x66\x73":msg}}))e['\x72\x65\x70\x6c\x79']("\u5bf9\u8bdd\u65b9\u5f0f\u6210\u529f\u66f4\u6539\x21")return false}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))let name=js['\x67\x70\x74\x78']['\x62\x6f\x74\x6e\x61\x6d\x65'] fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x78":{"\x62\x6f\x74\x6e\x61\x6d\x65":name,"\x66\x73":msg}}))e['\x72\x65\x70\x6c\x79']("\u5bf9\u8bdd\u65b9\u5f0f\u6210\u529f\u66f4\u6539\x21")return false}}}async gpthtzs(e){if(!e['\x69\x73\x4d\x61\x73\x74\x65\x72']){e['\x72\x65\x70\x6c\x79']("\u4f60\u7684\u6743\u9650\u4e0d\u591f")return false}if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#gpt设置绘图张数/g,"")['\x74\x72\x69\x6d']()htnum=window["\x4e\x75\x6d\x62\x65\x72"](msg['\x6d\x61\x74\x63\x68'](/\d+/g))if(htnum['\x6c\x65\x6e\x67\x74\x68']==-1){e['\x72\x65\x70\x6c\x79']("\u8f93\u5165\u7684\u6570\u5b57\u683c\u5f0f\u4e0d\u5bf9")return false}e['\x72\x65\x70\x6c\x79'](`gpt绘图张数已设置为:${htnum}`)}async gptgm(e){if(!e['\x69\x73\x4d\x61\x73\x74\x65\x72']){e['\x72\x65\x70\x6c\x79']("\u4f60\u7684\u6743\u9650\u4e0d\u591f")return false}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt改名/g,"")['\x74\x72\x69\x6d']()if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x78":{"\x62\x6f\x74\x6e\x61\x6d\x65":msg,"\x66\x73":"\u56fe\u7247"}}))}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))let gg=js['\x67\x70\x74\x78']['\x66\x73'] fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x78":{"\x62\x6f\x74\x6e\x61\x6d\x65":msg,"\x66\x73":gg}}))}await setName()e['\x72\x65\x70\x6c\x79']("\x67\x70\x74\u6539\u540d\u6210\u529f")}async gptht(e){if(typeof(htnum)=="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"){htnum=1}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt绘图/g,"")['\x74\x72\x69\x6d']()let b=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x74\x72\x61\x6e\x73\x6c\x61\x74\x65\x2d\x61\x70\x69\x2d\x66\x79\x6b\x7a\x2e\x78\x69\x61\x6e\x67\x74\x61\x74\x65\x63\x68\x2e\x63\x6f\x6d\x2f\x74\x72\x61\x6e\x73\x6c\x61\x74\x69\x6f\x6e\x2f\x77\x65\x62\x73\x2f\x69\x6e\x64\x65\x78",{"\x6d\x65\x74\x68\x6f\x64":"\x50\x4f\x53\x54","\x68\x65\x61\x64\x65\x72\x73":{"\x61\x63\x63\x65\x70\x74":"\x2a\x2f\x2a","\x61\x63\x63\x65\x70\x74\x2d\x6c\x61\x6e\x67\x75\x61\x67\x65":"\x7a\x68\x2d\x43\x4e\x2c\x7a\x68\x3b\x71\x3d\x30\x2e\x39\x2c\x65\x6e\x3b\x71\x3d\x30\x2e\x38\x2c\x65\x6e\x2d\x47\x42\x3b\x71\x3d\x30\x2e\x37\x2c\x65\x6e\x2d\x55\x53\x3b\x71\x3d\x30\x2e\x36","\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x74\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x2d\x77\x77\x77\x2d\x66\x6f\x72\x6d\x2d\x75\x72\x6c\x65\x6e\x63\x6f\x64\x65\x64",},"\x62\x6f\x64\x79":`appid=105&sgid=auto&sbid=auto&egid=en&ebid=en&content=${msg}&type=2`});b=await b['\x6a\x73\x6f\x6e']()console['\x6c\x6f\x67'](b)let by=await b['\x62\x79'] if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let key=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))apikey=key['\x67\x70\x74\x6b\x65\x79']['\x61\x70\x69\x6b\x65\x79']}let a=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x69\x6d\x61\x67\x65\x73\x2f\x67\x65\x6e\x65\x72\x61\x74\x69\x6f\x6e\x73",{method:"\x70\x6f\x73\x74",headers:{"\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x74\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e":"\x42\x65\x61\x72\x65\x72 "+apikey},body:JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x70\x72\x6f\x6d\x70\x74":by,"\x6e":htnum,})})a=await a['\x6a\x73\x6f\x6e']()console['\x6c\x6f\x67'](a)if(window["\x65\x76\x61\x6c"](htnum)>1){let nickname=e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let title="作品"let forwardMsg=[]let userInfo={user_id:e['\x75\x73\x65\x72\x5f\x69\x64'],nickname}for(var FhKA3=0;FhKA3<htnum;FhKA3++){let data=await a['\x64\x61\x74\x61'][FhKA3]['\x75\x72\x6c'] data=segment['\x69\x6d\x61\x67\x65'](data)let img={..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:data}forwardMsg['\x70\x75\x73\x68'](img)}if(e['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}else{let data=await a['\x64\x61\x74\x61'][0]['\x75\x72\x6c'] e['\x72\x65\x70\x6c\x79']([segment['\x69\x6d\x61\x67\x65'](data)])}}async gptys(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}let res=await fetch('\x68\x74\x74\x70\x73\x3a\x2f\x2f\x73\x68\x6f\x75\x71\x75\x61\x6e\x2d\x31\x33\x31\x35\x35\x34\x34\x35\x36\x32\x2e\x63\x6f\x73\x2e\x61\x70\x2d\x6e\x61\x6e\x6a\x69\x6e\x67\x2e\x6d\x79\x71\x63\x6c\x6f\x75\x64\x2e\x63\x6f\x6d\x2f\x73\x71\x71\x71\x2e\x6a\x73\x6f\x6e')res=await res['\x6a\x73\x6f\x6e']()res=await res['\x71\x71'] console['\x6c\x6f\x67'](res)if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u5207\u6362\u9884\u8bbe")){if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt切换预设/g,"")['\x74\x72\x69\x6d']()if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){let sg=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'],"\x75\x74\x66\x2d\x38")e['\x72\x65\x70\x6c\x79']("\u597d\u7684\uff0c\u7a0d\u7b49\u54e6\ud83c\udfc0\u8bf7\u7b49\u5f85\u56de\u590d\uff0c\u82e5\u56de\u590d\u6210\u529f\uff0c\u5219\u5207\u6362\u6210\u529f")history=[]if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let key=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))apikey=key['\x67\x70\x74\x6b\x65\x79']['\x61\x70\x69\x6b\x65\x79']}history['\x70\x75\x73\x68']({"\x72\x6f\x6c\x65":"\x73\x79\x73\x74\x65\x6d","\x63\x6f\x6e\x74\x65\x6e\x74":sg})if(typeof(model)=="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"){model="\x67\x70\x74\x2d\x34"}let tokens=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x63\x68\x61\x74\x2f\x74\x6f\x6b\x65\x6e\x69\x7a\x65\x72",{method:"\x70\x6f\x73\x74",headers:{"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e":"\x42\x65\x61\x72\x65\x72 "+apikey},body:JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x6d\x6f\x64\x65\x6c":model,"\x6d\x65\x73\x73\x61\x67\x65\x73":history})})tokens=await tokens['\x6a\x73\x6f\x6e']()let res=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x6d\x6f\x64\x65\x6c\x73")res=await res['\x6a\x73\x6f\x6e']()let content=await res['\x64\x61\x74\x61'] let now=content['\x66\x69\x6e\x64\x49\x6e\x64\x65\x78'](item=>item['\x69\x64']==model)let xian=JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](content[now]['\x74\x6f\x6b\x65\x6e\x73'])if(window["\x4e\x75\x6d\x62\x65\x72"](xian)<=window["\x4e\x75\x6d\x62\x65\x72"](JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](tokens['\x73\x74\x72\x69\x6e\x67']['\x63\x6f\x75\x6e\x74']))){let yyy=`当前预设占用tokens:${tokens['\x73\x74\x72\x69\x6e\x67']['\x63\x6f\x75\x6e\x74']}大于当前模型tokens:${xian},请减少预设内容`e['\x72\x65\x70\x6c\x79'](yyy,true)return false}let response=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x63\x68\x61\x74\x2f\x63\x6f\x6d\x70\x6c\x65\x74\x69\x6f\x6e\x73",{method:"\x70\x6f\x73\x74",headers:{accept:"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e":"\x42\x65\x61\x72\x65\x72 "+apikey},body:JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({model:model,messages:history})})response=await response['\x6a\x73\x6f\x6e']()if(response['\x64\x65\x74\x61\x69\x6c']){e['\x72\x65\x70\x6c\x79'](response['\x64\x65\x74\x61\x69\x6c']['\x72\x65\x70\x6c\x61\x63\x65']("\x54\x6f\x6f \x6d\x61\x6e\x79 \x74\x6f\x6b\x65\x6e\x73 \x69\x6e \x73\x79\x73\x74\x65\x6d \x61\x6e\x64 \x6c\x61\x73\x74 \x6d\x65\x73\x73\x61\x67\x65\x3a","\u5df2\u7ecf\u8d85\u51fa\u4e86\u53ef\u4f7f\u7528\u8303\u56f4\x74\x6f\x6b\x65\x6e\x73\x3a"))return false}if(!response['\x63\x68\x6f\x69\x63\x65\x73']){e['\x72\x65\x70\x6c\x79']("\u5f53\u524d\u9884\u8bbe\u4f7f\u7528\u5931\u8d25\x2c\u8bf7\u5207\u6362\u5176\u4ed6\u6a21\u578b")return false}let obj1=response['\x63\x68\x6f\x69\x63\x65\x73'][0]['\x6d\x65\x73\x73\x61\x67\x65'] let obj2={"\x72\x6f\x6c\x65":"\x61\x73\x73\x69\x73\x74\x61\x6e\x74"}let obj={..['\x6f\x62\x6a\x31'],..['\x6f\x62\x6a\x32']}history['\x70\x75\x73\x68'](obj)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'],JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](history))let answer=response['\x63\x68\x6f\x69\x63\x65\x73'][0]['\x6d\x65\x73\x73\x61\x67\x65']['\x63\x6f\x6e\x74\x65\x6e\x74'] if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){e['\x72\x65\x70\x6c\x79'](answer,true)return false}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))let n=js['\x67\x70\x74\x78']['\x66\x73'] if(n=="\u6587\u5b57"){e['\x72\x65\x70\x6c\x79'](answer,true)return false}if(n=="\u56fe\u7247"){let r1=e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let r2=Bot['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let content=answer['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,"\x3c\x62\x72\x3e")let html=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](_path+"\x2f\x70\x6c\x75\x67\x69\x6e\x73\x2f\x79\x2d\x74\x69\x61\x6e\x2d\x70\x6c\x75\x67\x69\x6e\x2f\x72\x65\x73\x6f\x75\x72\x63\x65\x73\x2f\x68\x74\x6d\x6c\x2f\x67\x70\x74\x78\x2e\x68\x74\x6d\x6c","\x75\x74\x66\x2d\x38")html=html['\x72\x65\x70\x6c\x61\x63\x65']("\x43\x6f\x6e\x74\x65\x6e\x74",content)fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](_path+"\x2f\x72\x65\x73\x6f\x75\x72\x63\x65\x73\x2f\x67\x70\x74\x78\x32\x2e\x68\x74\x6d\x6c",html,"\x75\x74\x66\x2d\x38")await common['\x73\x6c\x65\x65\x70'](1500)let data2={tplFile:_path+"\x2f\x72\x65\x73\x6f\x75\x72\x63\x65\x73\x2f\x67\x70\x74\x78\x32\x2e\x68\x74\x6d\x6c",dz:`${_path}/plugins/y-tian-plugin/resources/css/gptx['\x63\x73\x73\x60'],msg:msg,id2:Bot['\x75\x69\x6e'],id1:e['\x75\x73\x65\x72\x5f\x69\x64'],name:r1,name1:r2}let img=await puppeteer['\x73\x63\x72\x65\x65\x6e\x73\x68\x6f\x74']("\x37\x37\x37",{..['\x64\x61\x74\x61\x32'],});e['\x72\x65\x70\x6c\x79'](img)return true}if(n=="\u8f6c\u53d1"){let nickname=model let title="\x67\x70\x74\x78\u56de\u7b54"let forwardMsg=[]let userInfo={user_id:Bot['\x75\x69\x6e'],nickname}forwardMsg=[{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:answer}]if(e['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}}if(typeof(voice)=="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"){voice="\x61\x6e\x6f\x6e\x79\x67"}if(musickey==1){let url=`https:e['\x72\x65\x70\x6c\x79']([segment['\x72\x65\x63\x6f\x72\x64'](url)])}}else if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){e['\x72\x65\x70\x6c\x79']("\u5f53\u524d\u9884\u8bbe\u4e0d\u5b58\u5728\uff0c\u4e0d\u80fd\u4e71\u8f93\u5165\u54e6\u3002")}}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u9884\u8bbe\u5927\u5168")){let dir=fs['\x72\x65\x61\x64\x64\x69\x72\x53\x79\x6e\x63'](dirpath)let targetObj="\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"let index=dir['\x69\x6e\x64\x65\x78\x4f\x66'](targetObj)if(index!==-1){dir['\x73\x70\x6c\x69\x63\x65'](index,1)}let length=dir['\x6c\x65\x6e\x67\x74\x68'] console['\x6c\x6f\x67'](dir)dir=JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](dir)['\x72\x65\x70\x6c\x61\x63\x65'](/['\x74\x78\x74']/g,"\x3b")['\x72\x65\x70\x6c\x61\x63\x65']("\x5b","")['\x72\x65\x70\x6c\x61\x63\x65']("\x5d","")['\x72\x65\x70\x6c\x61\x63\x65'](/,"\x2f\x67\x2c""\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f"/g,"")let gh=dir['\x73\x70\x6c\x69\x74']("\x3b")let c=[]let separator="\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013\u2013"let endSeparator="\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d"for(var QnwvUukee4=0;QnwvUukee4<length;QnwvUukee4++){let v=`\n${separator}\n${QnwvUukee4+1}:${gh[QnwvUukee4]}`c['\x70\x75\x73\x68'](v)}c=`${c}`let hd=[`当前共有${length}个设定:`,c,`\n${endSeparator}\n\u53ef\u7528#gpt查看设定\n${endSeparator}\n\u4f8b:#gpt查看设定魅魔\n${endSeparator}`]e['\x72\x65\x70\x6c\x79'](hd['\x6a\x6f\x69\x6e']("\n"))}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u67e5\u770b\u9884\u8bbe")){let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt查看预设/g,"")['\x74\x72\x69\x6d']()if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){let sg=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'],"\x75\x74\x66\x2d\x38")let nickname="\x67\x70\x74\u9884\u8bbe\u5927\u5168"let title="\x67\x70\x74\u9884\u8bbe\u5927\u5168"if(e['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}let userInfo={user_id:Bot['\x75\x69\x6e'],nickname}let forwardMsg=[{..['\x75\x73\x65\x72\x49\x6e\x66\x6f'],message:sg}]if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){forwardMsg=await this['\x65']['\x67\x72\x6f\x75\x70']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}else{forwardMsg=await this['\x65']['\x66\x72\x69\x65\x6e\x64']['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](forwardMsg)}forwardMsg['\x64\x61\x74\x61']=forwardMsg['\x64\x61\x74\x61']['\x72\x65\x70\x6c\x61\x63\x65'](/\n/g,'')['\x72\x65\x70\x6c\x61\x63\x65'](/<title color="\x23\x37\x37\x37\x37\x37\x37" size="\x32\x36">(.+?)<\/title>/g,'\x5f\x5f\x5f')['\x72\x65\x70\x6c\x61\x63\x65'](/___+/,`<title color="\x23\x37\x37\x37\x37\x37\x37"size="\x32\x36">${title}</title>`)e['\x72\x65\x70\x6c\x79'](forwardMsg)}if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){e['\x72\x65\x70\x6c\x79']("\u5f53\u524d\u9884\u8bbe\u4e0d\u5b58\u5728")}}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u5220\u9664\u9884\u8bbe")){let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt删除预设/g,"")['\x74\x72\x69\x6d']()if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){e['\x72\x65\x70\x6c\x79']("\u6ca1\u6709\u8fd9\u4e2a\u9884\u8bbe\x2c\u4f60\u8f93\u9519\u4e86\u5427\uff1f")return false}if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath+"\x2f"+`${msg}['\x74\x78\x74\x60'])e['\x72\x65\x70\x6c\x79'](`当前预设:${msg}已成功删除!`)}}}async jblx(e){if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\u66f4\u6539\u5267\u672c\u79cd\u7c7b")){type=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#更改剧本种类/g,"")['\x74\x72\x69\x6d']()let msg=`当前剧本类型已切换为:${type}`e['\x72\x65\x70\x6c\x79'](msg)return true}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\u5267\u672c\u79cd\u7c7b")){e['\x72\x65\x70\x6c\x79']("\u5f53\u524d\u5267\u672c\u6709\x3a\u7231\u60c5\x2c\u53e4\u88c5\x2c\u5947\u5e7b\x2c\u72af\u7f6a\x2c\u6218\u4e89\x2c\u60ca\u609a\x2c\u5386\u53f2\x2c\u5bb6\u5ead\x2e\n\u8bf7\u53d1\u9001\x23\u66f4\u6539\u5267\u672c\u7c7b\u578b\x2b\u5185\u5bb9\u4fee\u6539\x2c\u4f8b\u5982\x3a\x23\u66f4\u6539\u5267\u672c\u7c7b\u578b\u559c\u5267")}}async cts(e){let num;let lx;let words=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#藏头诗五言/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/#藏头诗七言/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/#藏尾诗五言/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/#藏尾诗七言/g,"")['\x74\x72\x69\x6d']()if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\u5934")){lx="\x73\x74\x61\x72\x74"}else{lx="\x65\x6e\x64"}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\u4e94\u8a00")){num=5}else{num=7}let a=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x74\x73\x2e\x63\x68\x61\x7a\x68\x69\x2e\x6e\x65\x74\x2f",{"\x6d\x65\x74\x68\x6f\x64":"\x50\x4f\x53\x54","\x68\x65\x61\x64\x65\x72\x73":{"\x61\x63\x63\x65\x70\x74":"\x2a\x2f\x2a","\x61\x63\x63\x65\x70\x74\x2d\x6c\x61\x6e\x67\x75\x61\x67\x65":"\x7a\x68\x2d\x43\x4e\x2c\x7a\x68\x3b\x71\x3d\x30\x2e\x39\x2c\x65\x6e\x3b\x71\x3d\x30\x2e\x38\x2c\x65\x6e\x2d\x47\x42\x3b\x71\x3d\x30\x2e\x37\x2c\x65\x6e\x2d\x55\x53\x3b\x71\x3d\x30\x2e\x36","\x63\x6f\x6e\x74\x65\x6e\x74\x2d\x74\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x2d\x77\x77\x77\x2d\x66\x6f\x72\x6d\x2d\x75\x72\x6c\x65\x6e\x63\x6f\x64\x65\x64\x3b \x63\x68\x61\x72\x73\x65\x74\x3d\x55\x54\x46\x2d\x38","\x73\x65\x63\x2d\x63\x68\x2d\x75\x61":"\"\x4d\x69\x63\x72\x6f\x73\x6f\x66\x74 \x45\x64\x67\x65\"\x3b\x76\x3d\"\x31\x31\x33\"\x2c \"\x43\x68\x72\x6f\x6d\x69\x75\x6d\"\x3b\x76\x3d\"\x31\x31\x33\"\x2c \"\x4e\x6f\x74\x2d\x41\x2e\x42\x72\x61\x6e\x64\"\x3b\x76\x3d\"\x32\x34\"","\x73\x65\x63\x2d\x63\x68\x2d\x75\x61\x2d\x6d\x6f\x62\x69\x6c\x65":"\x3f\x30","\x73\x65\x63\x2d\x63\x68\x2d\x75\x61\x2d\x70\x6c\x61\x74\x66\x6f\x72\x6d":"\"\x57\x69\x6e\x64\x6f\x77\x73\"","\x73\x65\x63\x2d\x66\x65\x74\x63\x68\x2d\x64\x65\x73\x74":"\x65\x6d\x70\x74\x79","\x73\x65\x63\x2d\x66\x65\x74\x63\x68\x2d\x6d\x6f\x64\x65":"\x63\x6f\x72\x73","\x73\x65\x63\x2d\x66\x65\x74\x63\x68\x2d\x73\x69\x74\x65":"\x73\x61\x6d\x65\x2d\x6f\x72\x69\x67\x69\x6e","\x78\x2d\x72\x65\x71\x75\x65\x73\x74\x65\x64\x2d\x77\x69\x74\x68":"\x58\x4d\x4c\x48\x74\x74\x70\x52\x65\x71\x75\x65\x73\x74","\x52\x65\x66\x65\x72\x65\x72":"\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x74\x73\x2e\x63\x68\x61\x7a\x68\x69\x2e\x6e\x65\x74\x2f","\x52\x65\x66\x65\x72\x72\x65\x72\x2d\x50\x6f\x6c\x69\x63\x79":"\x73\x74\x72\x69\x63\x74\x2d\x6f\x72\x69\x67\x69\x6e\x2d\x77\x68\x65\x6e\x2d\x63\x72\x6f\x73\x73\x2d\x6f\x72\x69\x67\x69\x6e","\x75\x73\x65\x72\x2d\x61\x67\x65\x6e\x74":"\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30 \x28\x57\x69\x6e\x64\x6f\x77\x73 \x4e\x54 \x31\x30\x2e\x30\x3b \x57\x69\x6e\x36\x34\x3b \x78\x36\x34\x29 \x41\x70\x70\x6c\x65\x57\x65\x62\x4b\x69\x74\x2f\x35\x33\x37\x2e\x33\x36 \x28\x4b\x48\x54\x4d\x4c\x2c \x6c\x69\x6b\x65 \x47\x65\x63\x6b\x6f\x29 \x43\x68\x72\x6f\x6d\x65\x2f\x31\x31\x32\x2e\x30\x2e\x30\x2e\x30 \x53\x61\x66\x61\x72\x69\x2f\x35\x33\x37\x2e\x33\x36 \x45\x64\x67\x2f\x31\x31\x32\x2e\x30\x2e\x31\x37\x32\x32\x2e\x34\x36"},"\x62\x6f\x64\x79":`words=${words}&num=${num}&type=${lx}`});a=await a['\x6a\x73\x6f\x6e']()let da=await a['\x73\x75\x63\x63\x65\x73\x73'] da=`${da}`da=da['\x72\x65\x70\x6c\x61\x63\x65'](/<font color="\x28\x2e\x2a\x3f\x29">/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/<\/font>/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/<br\/>/g,"\n")['\x72\x65\x70\x6c\x61\x63\x65'](/,/g,"")e['\x72\x65\x70\x6c\x79'](da,true)}async jbsc(e){if(typeof(type)=="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"){type="\u559c\u5267"}let name=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?生成剧本/g,"")['\x74\x72\x69\x6d']()let data={"\x72\x6f\x6c\x65\x73":[name],"\x73\x63\x65\x6e\x61\x72\x69\x6f":type+"\u6545\u4e8b"}let a=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x64\x61\x74\x61\x6d\x75\x73\x65\x2e\x67\x75\x6f\x6b\x72\x2e\x63\x6f\x6d\x2f\x61\x70\x69\x2f\x6e\x65\x76\x65\x72\x2f\x63\x6f\x6d\x6d\x6f\x6e\x2f\x6d\x75\x73\x65\x2f\x74\x76\x2d\x63\x6f\x73\x6d\x6f\x73\x2f\x76\x31\x2f\x64\x72\x61\x6d\x61\x73",{"\x6d\x65\x74\x68\x6f\x64":"\x50\x4f\x53\x54","\x68\x65\x61\x64\x65\x72\x73":{"\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65":"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e","\x52\x65\x66\x65\x72\x65\x72":"\x68\x74\x74\x70\x73\x3a\x2f\x2f\x64\x61\x74\x61\x6d\x75\x73\x65\x2e\x67\x75\x6f\x6b\x72\x2e\x63\x6f\x6d\x2f\x6c\x74\x64","\x52\x65\x66\x65\x72\x72\x65\x72\x2d\x50\x6f\x6c\x69\x63\x79":"\x73\x74\x72\x69\x63\x74\x2d\x6f\x72\x69\x67\x69\x6e\x2d\x77\x68\x65\x6e\x2d\x63\x72\x6f\x73\x73\x2d\x6f\x72\x69\x67\x69\x6e","\x75\x73\x65\x72\x2d\x61\x67\x65\x6e\x74":"\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30 \x28\x57\x69\x6e\x64\x6f\x77\x73 \x4e\x54 \x31\x30\x2e\x30\x3b\x57\x69\x6e\x36\x34\x3b\x78\x36\x34\x29 \x41\x70\x70\x6c\x65\x57\x65\x62\x4b\x69\x74\x2f\x35\x33\x37\x2e\x33\x36 \x28\x4b\x48\x54\x4d\x4c\x2c \x6c\x69\x6b\x65 \x47\x65\x63\x6b\x6f\x29 \x43\x68\x72\x6f\x6d\x65\x2f\x31\x31\x32\x2e\x30\x2e\x30\x2e\x30 \x53\x61\x66\x61\x72\x69\x2f\x35\x33\x37\x2e\x33\x36 \x45\x64\x67\x2f\x31\x31\x32\x2e\x30\x2e\x31\x37\x32\x32\x2e\x34\x36"},"\x62\x6f\x64\x79":JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](data)});a=await a['\x6a\x73\x6f\x6e']()let drama=await a['\x64\x72\x61\x6d\x61'] drama=drama['\x72\x65\x70\x6c\x61\x63\x65'](/<strong>/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/<\/strong>/g,"")e['\x72\x65\x70\x6c\x79'](drama,true)}async changemodel(e){if(apikey=="\x31\x31\x34\x35\x31\x34"){this['\x72\x65\x70\x6c\x79']('\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002');return false}if(!e['\x69\x73\x4d\x61\x73\x74\x65\x72']){e['\x72\x65\x70\x6c\x79']("\u4f60\u7684\u6743\u9650\u4e0d\u591f")return false}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#?gpt切换模型/g,"")['\x74\x72\x69\x6d']()if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])}let response=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x6d\x6f\x64\x65\x6c\x73")response=await response['\x6a\x73\x6f\x6e']()let content=await response['\x64\x61\x74\x61'] model=content[msg-1]['\x69\x64'] let ms=`gpt模型成功切换,现在为${model}`history=[]e['\x72\x65\x70\x6c\x79'](ms)}async jsdh(e){if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u5bf9\u8bdd\u7ed3\u675f")){if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${e['\x75\x73\x65\x72\x5f\x69\x64']}['\x6a\x73\x6f\x6e\x60'])let mg=`用户【${e['\x73\x65\x6e\x64\x65\x72']['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}】已经重置对话了`e['\x72\x65\x70\x6c\x79'](mg,true)}else{e['\x72\x65\x70\x6c\x79']("\u60a8\u8fd8\u672a\u6709\u4efb\u4f55\u804a\u5929\u8bb0\u5f55")}}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u7ed3\u675f\u5168\u90e8\u5bf9\u8bdd")){if(!e['\x69\x73\x4d\x61\x73\x74\x65\x72']){e['\x72\x65\x70\x6c\x79']("\u4f60\u90a3\u6743\u9650\u4e0d\u591f")return false}let js=fs['\x72\x65\x61\x64\x64\x69\x72\x53\x79\x6e\x63'](dirpath2)let targetObj="\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"let index=js['\x69\x6e\x64\x65\x78\x4f\x66'](targetObj)js['\x73\x70\x6c\x69\x63\x65'](index,1)for(var EPEYbj5=0;EPEYbj5<js['\x6c\x65\x6e\x67\x74\x68'];EPEYbj5++){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](dirpath2+"\x2f"+`${js[EPEYbj5]}`)}history2=false e['\x72\x65\x70\x6c\x79'](`全部对话已重置,已结束${js['\x6c\x65\x6e\x67\x74\x68']}个用户的对话`)}}async gptkey(e){this['\x73\x65\x74\x43\x6f\x6e\x74\x65\x78\x74']('\x53\x61\x76\x65\x4b\x65\x79')await this['\x72\x65\x70\x6c\x79']('\u8bf7\u53d1\u9001\x4b\x65\x79',true)return false}async SaveKey(e){if(!this['\x65']['\x6d\x73\x67'])return let token=this['\x65']['\x6d\x73\x67'] let headers={'\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e':'\x42\x65\x61\x72\x65\x72 '+token}try{await fetch('\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x69\x6e\x66\x6f',{headers:headers});}catch(error){await this['\x72\x65\x70\x6c\x79']('\u5bc6\u94a5\u9a8c\u8bc1\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u5bc6\u94a5\u662f\u5426\u6b63\u786e',true)this['\x66\x69\x6e\x69\x73\x68']('\x53\x61\x76\x65\x4b\x65\x79')return}fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e",JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({"\x67\x70\x74\x6b\x65\x79":{"\x61\x70\x69\x6b\x65\x79":token}}))await this['\x72\x65\x70\x6c\x79']('\x67\x70\x74\x6b\x65\x79\u8bbe\u7f6e\u6210\u529f',true)this['\x66\x69\x6e\x69\x73\x68']('\x53\x61\x76\x65\x4b\x65\x79')}async modelhp(e){await this['\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67'](e)}async makeForwardMsg(e){let nickname=Bot['\x6e\x69\x63\x6b\x6e\x61\x6d\x65'] let title="\x67\x70\x74\u6a21\u578b\u5927\u5168"if(this['\x65']['\x69\x73\x47\x72\x6f\x75\x70']){let info=await Bot['\x67\x65\x74\x47\x72\x6f\x75\x70\x4d\x65\x6d\x62\x65\x72\x49\x6e\x66\x6f'](this['\x65']['\x67\x72\x6f\x75\x70\x5f\x69\x64'],Bot['\x75\x69\x6e'])nickname=info['\x63\x61\x72\x64']??info['\x6e\x69\x63\x6b\x6e\x61\x6d\x65']}let response=await fetch("\x68\x74\x74\x70\x73\x3a\x2f\x2f\x63\x68\x69\x6d\x65\x72\x61\x67\x70\x74\x2e\x61\x64\x76\x65\x6e\x74\x62\x6c\x6f\x63\x6b\x73\x2e\x63\x63\x2f\x76\x31\x2f\x6d\x6f\x64\x65\x6c\x73")response=await response['\x6a\x73\x6f\x6e']()let content=await response['\x64\x61\x74\x61'] let userInfo={user_id:Bot['\x75\x69\x6e'],nickname}let forwardMsg=[]for(var pR6=1;pR6<=content['\x6c\x65\x6e\x67\x74\x68'];pR6++){let k=pR6+"\x3a\n"+JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](content[pR6-1])['\x72\x65\x70\x6c\x61\x63\x65'](/{/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/}/g,"")['\x72\x65\x70\x6c\x61\x63\x65'](/,/g,"\n")['\x72\x65\x70\x6c\x61\x63\x65'](/"\x2f\x67\x2c""\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x6f\x77\x6e\x65\x64\x5f\x62\x79\x2f\x67\x2c"来源"\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x74\x79\x70\x65\x2f\x67\x2c"类型"\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x69\x64\x2f\x67\x2c"名称"\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x6f\x62\x6a\x65\x63\x74\x2f\x67\x2c"用途"\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x74\x6f\x6b\x65\x6e\x73\x2f\x67\x2c"支持最大字符数"\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x70\x65\x72\x6d\x69\x73\x73\x69\x6f\x6e\x3a\x5b\x5d\x2f\x67\x2c""\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x66\x61\x6c\x6c\x62\x61\x63\x6b\x73\x2f\x67\x2c"下位替代"\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x65\x6e\x64\x70\x6f\x69\x6e\x74\x73\x3a\[\x28\x2e\x2a\x3f\x29\]\x2f\x67\x2c""\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x70\x65\x72\x6d\x69\x73\x73\x69\x6f\x6e\x3a\[\x28\x2e\x2a\x3f\x29\]\x2f\x67\x2c""\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x6c\x69\x6d\x69\x74\x73\x2f\x67\x2c"可能的限制"\x29\x6c\x65\x74 \x6e\x72\x3d\x7b\x2e\x2e\x2e\x75\x73\x65\x72\x49\x6e\x66\x6f\x2c\x6d\x65\x73\x73\x61\x67\x65\x3a\x6b\x7d\x66\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x2e\x70\x75\x73\x68\x28\x6e\x72\x29\x7d\x69\x66\x28\x74\x68\x69\x73\x2e\x65\x2e\x69\x73\x47\x72\x6f\x75\x70\x29\x7b\x66\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x3d\x61\x77\x61\x69\x74 \x74\x68\x69\x73\x2e\x65\x2e\x67\x72\x6f\x75\x70\x2e\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x28\x66\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x29\x7d\x65\x6c\x73\x65\x7b\x66\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x3d\x61\x77\x61\x69\x74 \x74\x68\x69\x73\x2e\x65\x2e\x66\x72\x69\x65\x6e\x64\x2e\x6d\x61\x6b\x65\x46\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x28\x66\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x29\x7d\x66\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x2e\x64\x61\x74\x61\x3d\x66\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x2e\x64\x61\x74\x61\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\n\x2f\x67\x2c\x27\x27\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x3c\x74\x69\x74\x6c\x65 \x63\x6f\x6c\x6f\x72\x3d"#777777" \x73\x69\x7a\x65\x3d"26"\x3e\x28\x2e\x2b\x3f\x29\x3c\/\x74\x69\x74\x6c\x65\x3e\x2f\x67\x2c\x27\x5f\x5f\x5f\x27\x29\x2e\x72\x65\x70\x6c\x61\x63\x65\x28\x2f\x5f\x5f\x5f\x2b\x2f\x2c\x60\x3c\x74\x69\x74\x6c\x65 \x63\x6f\x6c\x6f\x72\x3d"#777777"\x73\x69\x7a\x65\x3d"26"\x3e\x24\x7b\x74\x69\x74\x6c\x65\x7d\x3c\x2f\x74\x69\x74\x6c\x65\x3e\x60\x29\x65\x2e\x72\x65\x70\x6c\x79\x28\x66\x6f\x72\x77\x61\x72\x64\x4d\x73\x67\x29\x7d\x61\x73\x79\x6e\x63 \x67\x70\x74\x78\x28\x65\x29\x7b\x69\x66\x28\x61\x70\x69\x6b\x65\x79\x3d\x3d"114514"\x29\x7b\x74\x68\x69\x73\x2e\x72\x65\x70\x6c\x79\x28\x27\u6b64\u529f\u80fd\u4e3a\u53d1\u7535\u7528\u6237\u4e13\u4eab\u3002\x27\x29\x3b\x72\x65\x74\x75\x72\x6e \x66\x61\x6c\x73\x65\x7d\x69\x66\x28\x65\x2e\x6d\x65\x73\x73\x61\x67\x65\x29\x7b\x69\x66\x28\x66\x73\x2e\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63\x28\x64\x69\x72\x70\x61\x74\x68\x32\x2b"/data['\x6a\x73\x6f\x6e']")){let js=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath2+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))botname=js['\x67\x70\x74\x78']['\x62\x6f\x74\x6e\x61\x6d\x65']}if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73']("\x23\x67\x70\x74\u65b0\u589e\u9884\u8bbe")){let m=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](/#gpt新增预设/g,"")['\x74\x72\x69\x6d']()let ms=m['\x73\x70\x6c\x69\x74']("\x2f")let txt=ms[1]console['\x6c\x6f\x67'](ms[0])ms=`${ms[0]}`txt=`${txt}`fs['\x61\x70\x70\x65\x6e\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f"+`${ms}['\x74\x78\x74\x60'],txt)e['\x72\x65\x70\x6c\x79'](`Gpt新增预设:\n[${ms}]`)return false}else if(e['\x6d\x73\x67']['\x69\x6e\x63\x6c\x75\x64\x65\x73'](botname)){if(CD[e['\x75\x73\x65\x72\x5f\x69\x64']]&&GetCD===true&&!e['\x69\x73\x4d\x61\x73\x74\x65\x72']){e['\x72\x65\x70\x6c\x79']("\u9664\u4e86\u4e3b\u4eba\u4e4b\u5916\x2c\u5176\u4ed6\u4eba\u6bcf\x32\u5206\u949f\u6700\u591a\u4e00\u6b21\u95ee\u7b54");return false}CD[e['\x75\x73\x65\x72\x5f\x69\x64']]=true;CD[e['\x75\x73\x65\x72\x5f\x69\x64']]=setTimeout(()=>{if(CD[e['\x75\x73\x65\x72\x5f\x69\x64']]){delete CD[e['\x75\x73\x65\x72\x5f\x69\x64']]}},CDTime);if(fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e")){let key=JSON['\x70\x61\x72\x73\x65'](fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](dirpath+"\x2f\x64\x61\x74\x61\x2e\x6a\x73\x6f\x6e"))apikey=key['\x67\x70\x74\x6b\x65\x79']['\x61\x70\x69\x6b\x65\x79']}let msg=e['\x6d\x73\x67']['\x72\x65\x70\x6c\x61\x63\x65'](botname,"")['\x74\x72\x69\x6d']()if(e['\x6d\x65\x73\x73\x61\x67\x65']['\x66\x69\x6e\x64'](val=>val['\x74\x79\x70\x65']==='\x69\x6d\x61\x67\x65')){function gettk(){let options={'\x6d\x65\x74\x68\x6f\x64':'\x50\x4f\x53\x54','\x75\x72\x6c':'\x68\x74\x74\x70\x73\x3a\x2f\x2f\x61\x69\x70\x2e\x62\x61\x69\x64\x75\x62\x63\x65\x2e\x63\x6f\x6d\x2f\x6f\x61\x75\x74\x68\x2f\x32\x2e\x30\x2f\x74\x6f\x6b\x65\x6e\x3f\x67\x72\x61\x6e\x74\x5f\x74\x79\x70\x65\x3d\x63\x6c\x69\x65\x6e\x74\x5f\x63\x72\x65\x64\x65\x6e\x74\x69\x61\x6c\x73\x26\x63\x6c\x69\x65\x6e\x74\x5f\x69\x64\x3d'+AK+'\x26\x63\x6c\x69\x65\x6e\x74\x5f\x73\x65\x63\x72\x65\x74\x3d'+SK,}return new Promise((resolve,reject)=>{request(options,(error,response)=>{if(error){console['\x6c\x6f\x67']("\u5931\u8d25\u4e86")}else{resolve(JSON['\x70\x61\x72\x73\x65'](response['\x62\x6f\x64\x79'])['\x61\x63\x63\x65\x73\x73\x5f\x74\x6f\x6b\x65\x6e'])}})})}const varUrl=e['\x69\x6d\x67'][0]const url='\x68\x74\x74\x70\x73\x3a\x2f\x2f\x61\x69\x70\x2e\x62\x61\x69\x64\x75\x62\x63\x65\x2e\x63\x6f\x6d\x2f\x72\x65\x73\x74\x2f\x32\x2e\x30\x2f\x6f\x63\x72\x2f\x76\x31\x2f\x67\x65\x6e\x65\x72\x61\x6c\x5f\x62\x61\x73\x69\x63\x3f\x61\x63\x63\x65\x73\x73\x5f\x74\x6f\x6b\x65\x6e\x3d'+await gettk();const response=await fetch(url,{method:'\x50\x4f\x53\x54',headers:{'\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65':'\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x78\x2d\x77\x77\x77\x2d\x66\x6f\x72\x6d\x2d\x75\x72\x6c\x65\x6e\x63\x6f\x64\x65\x64','\x41\x63\x63\x65\x70\x74':'\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e'},body:new URLSearchParams({url:varUrl})});let pR6=e['\x6d\x65\x73\x73\x61\x67\x65'] function findById(array,KQ$GCee7){return array['\x66\x69\x6e\x64'](function(EYWYEhf8){return EYWYEhf8['\x74\x79\x70\x65']===KQ$GCee7})}const result=findById(pR6,"\x74\x65\x78\x74");let wen=result['\x74\x65\x78\x74'] const responseData=await response['\x6a\x73\x6f\x6e']();let km=[]for(let jj=0;jj<responseData['\x77\x6f\x72\x64\x73\x5f\x72\x65\x73\x75\x6c\x74']['\x6c\x65\x6e\x67\x74\x68'];jj++){km['\x70\x75\x73\x68'](responseData['\x77\x6f\x72\x64\x73\x5f\x72\x65\x73\x75\x6c\x74'][jj]['\x77\x6f\x72\x64\x73'])}km=JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](km)km=km['\x72\x65\x70\x6c\x61\x63\x65']("\x5d","")['\x72\x65\x70\x6c\x61\x63\x65']("\x5b","")['\x72\x65\x70\x6c\x61\x63\x65'](/"\x2f\x67\x2c""\x29\x6d\x73\x67\x3d\x6b\x6d\x2b"\n"\x2b\x77\x65\x6e\x7d\x69\x66\x28\x66\x73\x2e\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63\x28\x64\x69\x72\x70\x61\x74\x68\x32\x2b"/"\x2b\x60\x24\x7b\x65\x2e\x75\x73\x65\x72\x5f\x69\x64\x7d\x2e\x6a\x73\x6f\x6e\x60\x29\x29\x7b\x68\x69\x73\x74\x6f\x72\x79\x3d\x66\x73\x2e\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63\x28\x64\x69\x72\x70\x61\x74\x68\x32\x2b"/"\x2b\x60\x24\x7b\x65\x2e\x75\x73\x65\x72\x5f\x69\x64\x7d\x2e\x6a\x73\x6f\x6e\x60\x2c"utf-8"\x29\x68\x69\x73\x74\x6f\x72\x79\x3d\x4a\x53\x4f\x4e\x2e\x70\x61\x72\x73\x65\x28\x68\x69\x73\x74\x6f\x72\x79\x29\x69\x66\x28\x21\x68\x69\x73\x74\x6f\x72\x79\x32\x3d\x3d\x66\x61\x6c\x73\x65\x29\x7b\x6c\x65\x74 \x6e\x6f\x77\x3d\x68\x69\x73\x74\x6f\x72\x79\x2e\x66\x69\x6e\x64\x49\x6e\x64\x65\x78\x28\x69\x74\x65\x6d\x3d\x3e\x69\x74\x65\x6d\x2e\x72\x6f\x6c\x65\x3d\x3d"system"\x29\x69\x66\x28\x6e\x6f\x77\x3d\x3d\x2d\x31\x29\x7b\x68\x69\x73\x74\x6f\x72\x79\x2e\x70\x75\x73\x68\x28\x7b\x72\x6f\x6c\x65\x3a"system"\x2c\x63\x6f\x6e\x74\x65\x6e\x74\x3a\x68\x69\x73\x74\x6f\x72\x79\x32\x7d\x29\x7d\x7d\x7d\x65\x6c\x73\x65\x7b\x68\x69\x73\x74\x6f\x72\x79\x3d\x5b\x5d\x69\x66\x28\x21\x68\x69\x73\x74\x6f\x72\x79\x32\x3d\x3d\x66\x61\x6c\x73\x65\x29\x7b\x6c\x65\x74 \x6e\x6f\x77\x3d\x68\x69\x73\x74\x6f\x72\x79\x2e\x66\x69\x6e\x64\x49\x6e\x64\x65\x78\x28\x69\x74\x65\x6d\x3d\x3e\x69\x74\x65\x6d\x2e\x72\x6f\x6c\x65\x3d\x3d"system"\x29\x69\x66\x28\x6e\x6f\x77\x3d\x3d\x2d\x31\x29\x7b\x68\x69\x73\x74\x6f\x72\x79\x2e\x70\x75\x73\x68\x28\x7b\x72\x6f\x6c\x65\x3a"system"\x2c\x63\x6f\x6e\x74\x65\x6e\x74\x3a\x68\x69\x73\x74\x6f\x72\x79\x32\x7d\x29\x7d\x7d\x7d\x68\x69\x73\x74\x6f\x72\x79\x2e\x70\x75\x73\x68\x28\x7b"role"\x3a"user"\x2c"content"\x3a\x6d\x73\x67\x7d\x29\x69\x66\x28\x74\x79\x70\x65\x6f\x66\x28\x6d\x6f\x64\x65\x6c\x29\x3d\x3d"undefined"\x29\x7b\x6d\x6f\x64\x65\x6c\x3d"gpt-4"\x7d\x6c\x65\x74 \x72\x65\x73\x70\x6f\x6e\x73\x65\x3d\x61\x77\x61\x69\x74 \x66\x65\x74\x63\x68\x28"https://chimeragpt.adventblocks.cc/v1/chat/completions",{method:"post",headers:{accept:"application/json","Content-Type":"application/json","Authorization":"Bearer "+apikey},body:JSON.stringify({model:model,messages:history})})response=await response.json()if(response.detail){e.reply(response.detail.replace("Too many tokens in system and last message:","已经超出了可使用范围tokens:"))return false}if(!response.choices){e.reply("当前模型使用失败,请重新提问或者切换其他模型")return false}if(typeof(voice)=="undefined"){voice="anonyg"}let obj1=response.choices[0].message let obj2={"role":"assistant"}let obj={...obj1,...obj2}history.push(obj)fs.writeFileSync(dirpath2+"/"+`${e.user_id}.json`,JSON.stringify(history))let answer=response.choices[0].message.content if(!fs.existsSync(dirpath2+"/data.json")){e.reply(answer,true)if(musickey==1){let url=`https:e.reply([segment.record(url)])}return false}if(fs.existsSync(dirpath2+"/data.json")){let js=JSON.parse(fs.readFileSync(dirpath2+"/data.json"))let n=js.gptx.fs if(n=="文字"){e.reply(answer,true)if(musickey==1){let url=`https:e.reply([segment.record(url)])}return false}if(n=="图片"){let r1=e.sender.nickname let r2=Bot.nickname let content=answer.replace(/\n/g,"<br>")let html=fs.readFileSync(_path+"/plugins/y-tian-plugin/resources/html/gptx.html","utf-8")html=html.replace("Content",content)fs.writeFileSync(_path+"/resources/gptx2.html",html,"utf-8")await common.sleep(1500)let data2={tplFile:_path+"/resources/gptx2.html",dz:`${_path}/plugins/y-tian-plugin/resources/css/gptx.css`,msg:msg,id2:Bot.uin,id1:e.user_id,name:r1,name1:r2}let img=await puppeteer.screenshot("777",{...data2,});e.reply(img)if(musickey==1){let url=`https:e.reply([segment.record(url)])}return true}if(n=="转发"){let nickname=model let title="gptx回答"let forwardMsg=[]let userInfo={user_id:Bot.uin,nickname}forwardMsg=[{...userInfo,message:answer}]if(e.isGroup){let info=await Bot.getGroupMemberInfo(this.e.group_id,Bot.uin)nickname=info.card??info.nickname}if(this.e.isGroup){forwardMsg=await this.e.group.makeForwardMsg(forwardMsg)}else{forwardMsg=await this.e.friend.makeForwardMsg(forwardMsg)}forwardMsg.data=forwardMsg.data.replace(/\n/g,'').replace(/<title color="#777777" size="26">(.+?)<\/title>/g,'___').replace(/___+/,`<title color="#777777"size="26">${title}</title>`)e.reply(forwardMsg)if(musickey==1){let url=`https:e.reply([segment.record(url)])}}if(n=="视频"){let url=`https:let response=await fetch(url)let buff=await response.arrayBuffer();fs.writeFileSync("mao.mp3",Buffer.from(buff),"binary",);var ex=require('child_process').exec;let o=_path+`/resources/${e.user_id}/1.mp3`let image=segment.image(`http:var ls=ex(`ffmpeg-r 15-t 15-f image2-loop 1-i mao.png-i mao.mp3 mao.mp4-y`,function(error,stdout,stderr){if(error){e.reply("失败了！")}else{var i=ex("ffmpeg -i mao.mp4 -i mao.jpg -map 1 -map 0 -c copy -disposition:0 attached_pic out.mp4 -y",function(error,stdout,stderr){if(error){e.reply("失败了！")}else{let path=_path+"/out.mp4"e.reply([segment.video(path)])}})}})}}}return false}}}